/******** BEGIN cachedTypes.js ********//*
    ***** BEGIN LICENSE BLOCK *****
    
    Copyright © 2011 Center for History and New Media
                     George Mason University, Fairfax, Virginia, USA
                     http://zotero.org
    
    This file is part of Zotero.
    
    Zotero is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
    
    Zotero is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.
    
    You should have received a copy of the GNU Affero General Public License
    along with Zotero.  If not, see <http://www.gnu.org/licenses/>.
    
    ***** END LICENSE BLOCK *****
*//**
 * Emulates very small parts of cachedTypes.js and itemFields.js APIs for use with connector
 *//**
 * @namespace
 */function startTranslation(){Zotero.ProgressWindow.show(),Zotero.ProgressWindow.changeHeadline("Looking for Zotero Standalone..."),zoteroIFrame=document.createElement("iframe"),zoteroIFrame.id="zotero-privileged-iframe",zoteroIFrame.src=ZOTERO_CONFIG.BOOKMARKLET_URL+"iframe"+(navigator.appName==="Microsoft Internet Explorer"?"_ie":"")+".html",zoteroIFrame.style.display="none",document.body.appendChild(zoteroIFrame),document.body.style.overflow="hidden"}function cleanup(){zoteroIFrame.parentNode.removeChild(zoteroIFrame),window.frameElement.parentNode.removeChild(window.frameElement)}Zotero.Connector_Types=new function(){this.init=function(){const e=["itemTypes","creatorTypes","fields"];for(var t=0;t<e.length;t++){var n=e[t];this[n]=Zotero.Utilities.deepCopy(Zotero.Connector_Types.schema[n]);for(var r in Zotero.Connector_Types.schema[n]){var i=this[n][r];i.unshift(parseInt(r,10)),this[n][i[1]]=i}}var s=Zotero.Connector_Types.itemTypes,o=Zotero.Connector_Types.creatorTypes,u=Zotero.Connector_Types.fields;Zotero.CachedTypes=function(){var e=Zotero.Connector_Types[this.schemaType];this.getID=function(t){var n=e[t];return n?n[0]:!1},this.getName=function(t){var n=e[t];return n?n[1]:!1},this.getLocalizedString=function(t){var n=e[t];return n?n[2]:!1}},Zotero.ItemTypes=new function(){this.schemaType="itemTypes",Zotero.CachedTypes.call(this),this.getImageSrc=function(e){var t=Zotero.Connector_Types.itemTypes[e],n=t?t[6]:"treeitem-"+e+".png";if(Zotero.isBookmarklet)return ZOTERO_CONFIG.BOOKMARKLET_URL+"images/"+n;if(Zotero.isFx)return"chrome://zotero/skin/"+n;if(Zotero.isChrome)return chrome.extension.getURL("images/"+n);if(Zotero.isSafari)return safari.extension.baseURI+"images/itemTypes/"+n}},Zotero.CreatorTypes=new function(){this.schemaType="creatorTypes",Zotero.CachedTypes.call(this),this.getTypesForItemType=function(e){var t=s[e];if(!t)return!1;var n=t[3],r=n.length,i=new Array(r);for(var u=0;u<r;u++){var a=o[n[u]];i[u]={id:a[0],name:a[1]}}return i},this.getPrimaryIDForType=function(e){var t=s[e];return t?s[3][0]:!1}},Zotero.ItemFields=new function(){this.schemaType="fields",Zotero.CachedTypes.call(this),this.isValidForType=function(e,t){var n=u[e],r=s[t];return!n||!r?!1:r[4].indexOf(n[0])!==-1},this.getFieldIDFromTypeAndBase=function(e,t){var n=u[t],r=s[e];if(!n||!r)return!1;n=n[0];var i=r[5];for(var o in i)if(i[o]===n)return o;return!1},this.getBaseIDFromTypeAndField=function(e,t){var n=u[t],r=s[e];if(!n||!r)throw new Error("Invalid field or type ID");var i=r[5][n[0]];return i?i:!1},this.getItemTypeFields=function(e){return s[e][4].slice()}}},this.getSchema=function(e){e(Zotero.Connector_Types.schema)}},Zotero.Date=new function(){function n(e,t){try{var n=e.split(" "),r=n[0].split("-");if(n[1])var i=n[1].split(":");else i=[!1,!1,!1];return r.length==1?!1:t?new Date(Date.UTC(r[0],r[1]-1,r[2],i[0],i[1],i[2])):new Date(r[0],r[1]-1,r[2],i[0],i[1],i[2])}catch(s){return Zotero.debug(e+" is not a valid SQL date",2),!1}}function r(e,t){try{if(!t)return e.toLocaleFormat("%Y-%m-%d %H:%M:%S");var n=e.getUTCFullYear(),r=e.getUTCMonth(),i=e.getUTCDate(),s=e.getUTCHours(),o=e.getUTCMinutes(),u=e.getUTCSeconds();return n=Zotero.Utilities.lpad(n,"0",4),r=Zotero.Utilities.lpad(r+1,"0",2),i=Zotero.Utilities.lpad(i,"0",2),s=Zotero.Utilities.lpad(s,"0",2),o=Zotero.Utilities.lpad(o,"0",2),u=Zotero.Utilities.lpad(u,"0",2),n+"-"+r+"-"+i+" "+s+":"+o+":"+u}catch(a){return Zotero.debug(e+" is not a valid JS date",2),""}}function a(e){var n={order:""};if(!e)return n;var r=[],a=(e+"").toLowerCase();a=="yesterday"||Zotero.getString&&a===Zotero.getString("date.yesterday")?e=Zotero.Date.dateToSQL(new Date(Date.now()-864e5)).substr(0,10):a=="today"||Zotero.getString&&a==Zotero.getString("date.today")?e=Zotero.Date.dateToSQL(new Date).substr(0,10):a=="tomorrow"||Zotero.getString&&a==Zotero.getString("date.tomorrow")?e=Zotero.Date.dateToSQL(new Date(Date.now()+864e5)).substr(0,10):e=e.toString().replace(/^\s+|\s+$/g,"").replace(/\s+/," ");var l=i.exec(e);if(l&&(!l[5]||!l[3]||l[3]==l[5]||l[3]=="年"&&l[5]=="月")&&(l[2]&&l[4]&&l[6]||!l[1]&&!l[7])){if(l[2].length==3||l[2].length==4||l[3]=="年")n.year=l[2],n.month=l[4],n.day=l[6],n.order+=l[2]?"y":"",n.order+=l[4]?"m":"",n.order+=l[6]?"d":"";else if(l[2]&&!l[4]&&l[6])n.month=l[2],n.year=l[6],n.order+=l[2]?"m":"",n.order+=l[6]?"y":"";else{var c=Zotero.locale?Zotero.locale.substr(3):"US";c=="US"||c=="FM"||c=="PW"||c=="PH"?(n.month=l[2],n.day=l[4],n.order+=l[2]?"m":"",n.order+=l[4]?"d":""):(n.month=l[4],n.day=l[2],n.order+=l[2]?"d":"",n.order+=l[4]?"m":""),n.year=l[6],n.order+="y"}n.year&&(n.year=parseInt(n.year,10)),n.day&&(n.day=parseInt(n.day,10));if(n.month){n.month=parseInt(n.month,10);if(n.month>12){var h=n.day;n.day=n.month,n.month=h,n.order=n.order.replace("m","D").replace("d","M").replace("D","d").replace("M","m")}}if((!n.month||n.month<=12)&&(!n.day||n.day<=31)){if(n.year&&n.year<100){var p=new Date,d=p.getFullYear(),v=d%100,m=d-v;n.year<=v?n.year=m+n.year:n.year=m-100+n.year}n.month&&n.month--,Zotero.debug("DATE: retrieved with algorithms: "+JSON.stringify(n)),r.push({part:l[1],before:!0},{part:l[7]})}else{Zotero.debug("DATE: algorithms failed sanity check");var n={order:""};r.push({part:e})}}else Zotero.debug("DATE: could not apply algorithms"),r.push({part:e});if(!n.year)for(var g in r){var l=s.exec(r[g].part);if(l){n.year=l[2],n.order=f(n.order,"y",r[g]),r.splice(g,1,{part:l[1],before:!0},{part:l[3]}),Zotero.debug("DATE: got year ("+n.year+", "+JSON.stringify(r)+")");break}}if(!n.month){var y=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];if(Zotero.locale!="en-US"){Zotero.Date.getMonths(),y=y.concat(t["short"]).concat(t["long"]);for(var g=0,b=y.length;g<b;g++)y[g]=y[g].toLowerCase()}o||(o=new RegExp("^(.*)\\b("+y.join("|")+")[^ ]*(?: (.*)$|$)","i"));for(var g in r){var l=o.exec(r[g].part);if(l){n.month=y.indexOf(l[2].toLowerCase())%12,n.order=f(n.order,"m",r[g]),r.splice(g,1,{part:l[1],before:"m"},{part:l[3],after:"m"}),Zotero.debug("DATE: got month ("+n.month+", "+JSON.stringify(r)+")");break}}}if(!n.day){if(!u){var w=Zotero.getString?Zotero.getString("date.daySuffixes").replace(/, ?/g,"|"):"";u=new RegExp("\\b([0-9]{1,2})(?:"+w+")?\\b(.*)","i")}for(var g in r){var l=u.exec(r[g].part);if(l){var E=parseInt(l[1],10);if(E<=31){n.day=E,n.order=f(n.order,"d",r[g]);if(l.index>0){var S=r[g].part.substr(0,l.index);l[2]&&(S+=" "+l[2])}else var S=l[2];r.splice(g,1,{part:S}),Zotero.debug("DATE: got day ("+n.day+", "+JSON.stringify(r)+")");break}}}}n.part="";for(var g in r)n.part+=r[g].part+" ";n.part&&(n.part=n.part.replace(/^[^A-Za-z0-9]+|[^A-Za-z0-9]+$/g,"")),(n.part===""||n.part==undefined)&&delete n.part;if(n.year||n.year===0)n.year+="";return n}function f(e,t,n){if(!e)return t;if(n.before===!0)return t+e;if(n.after===!0)return e+t;if(n.before){var r=e.indexOf(n.before);return r==-1?e:e.replace(new RegExp("("+n.before+")"),t+"$1")}if(n.after){var r=e.indexOf(n.after);return r==-1?e+t:e.replace(new RegExp("("+n.after+")"),"$1"+t)}return e+t}function l(e,t){if(t){var n=A(),r=n[0]+"/"+n[1]+"/"+n[2];return r.replace("y",e.year!==undefined?e.year:"00").replace("m",e.month!==undefined?1+e.month:"0").replace("d",e.day!==undefined?e.day:"0")}var r="";e.part&&(r+=e.part+" ");var i=Zotero.Date.getMonths().long;return e.month!=undefined&&i[e.month]&&(r+=i[e.month],e.day?r+=" "+e.day+", ":r+=" "),e.year&&(r+=e.year),r}function c(e){var t=Zotero.Date.strToDate(e);if(t.year){var n=Zotero.Utilities.lpad(t.year,"0",4);return t.month&&(n+="-"+Zotero.Utilities.lpad(t.month+1,"0",2),t.day&&(n+="-"+Zotero.Utilities.lpad(t.day,"0",2))),n}return!1}function h(e){if(!e)return"";var t=a(e);if(t.year){var n=t.year+"";n.match(/^[0-9]{1,4}$/)||delete t.year}t.month=typeof t.month!="undefined"?t.month+1:"";var r=(t.year?Zotero.Utilities.lpad(t.year,"0",4):"0000")+"-"+Zotero.Utilities.lpad(t.month,"0",2)+"-"+(t.day?Zotero.Utilities.lpad(t.day,"0",2):"00")+" "+e;return r}function g(e){return E(e)?!1:p.test(e)}function y(e){return e?g(e)?e.substr(0,10):"0000-00-00":""}function b(e){return e?g(e)?e.substr(11):e:""}function w(e,t){return t?v.test(e):d.test(e)}function E(e){return m.test(e)}function S(e){return w(e,!0)&&e.substr(0,4)!="0000"}function x(e){return w(e,!0)&&e.substr(5,2)!="00"}function T(e){return w(e,!0)&&e.substr(8,2)!="00"}function N(){return Math.round(Date.now()/1e3)}function C(e){if(e===null||typeof e!="object"||e.constructor.name!="Date")throw"Not a valid date in Zotero.Date.toUnixTimestamp()";return Math.round(e.getTime()/1e3)}function k(e){var t=new Date;return t.setTime(e.lastModifiedTime),t.toLocaleDateString()}function L(e){var t=new Date;return t.setTime(e.lastModifiedTime),t.toLocaleTimeString()}function A(){if(!e)switch(Zotero.locale?Zotero.locale.substr(3):"US"){case"US":case"BZ":case"FM":case"PA":case"PH":case"PW":case"ZW":e="mdy";break;case"fa":case"AL":case"CA":case"CN":case"HU":case"JP":case"KE":case"KR":case"LT":case"LV":case"MN":case"SE":case"TW":case"ZA":e="ymd";break;default:e="dmy"}return e}this.sqlToDate=n,this.dateToSQL=r,this.strToDate=a,this.formatDate=l,this.strToISO=c,this.strToMultipart=h,this.isMultipart=g,this.multipartToSQL=y,this.multipartToStr=b,this.isSQLDate=w,this.isSQLDateTime=E,this.sqlHasYear=S,this.sqlHasMonth=x,this.sqlHasDay=T,this.getUnixTimestamp=N,this.toUnixTimestamp=C,this.getFileDateString=k,this.getFileTimeString=L,this.getLocaleDateOrder=A;var e=null,t=null;this.getMonths=function(){if(t)return t;if(Zotero.isFx&&!Zotero.isBookmarklet){var e="chrome://global/locale/dateFormat.properties",n=Components.classes["@mozilla.org/intl/nslocaleservice;1"].getService(Components.interfaces.nsILocaleService),r=n.getApplicationLocale(),i=Components.classes["@mozilla.org/intl/stringbundle;1"].getService(Components.interfaces.nsIStringBundleService).createBundle(e,r);t={"short":[],"long":[]};for(var s=1;s<=12;s++)t.short.push(i.GetStringFromName("month."+s+".Mmm")),t.long.push(i.GetStringFromName("month."+s+".name"))}else t={"short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"long":["January","February","March","April","May","June","July","August","September","October","November","December"]};return t},this.dateToISO=function(e){var t=e.getUTCFullYear(),n=e.getUTCMonth(),r=e.getUTCDate(),i=e.getUTCHours(),s=e.getUTCMinutes(),o=e.getUTCSeconds();return t=Zotero.Utilities.lpad(t,"0",4),n=Zotero.Utilities.lpad(n+1,"0",2),r=Zotero.Utilities.lpad(r,"0",2),i=Zotero.Utilities.lpad(i,"0",2),s=Zotero.Utilities.lpad(s,"0",2),o=Zotero.Utilities.lpad(o,"0",2),t+"-"+n+"-"+r+"T"+i+":"+s+":"+o+"Z"},this.isoToDate=function(e){var t=/([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?/,n=e.match(t),r=0,i=new Date(n[1],0,1);n[3]&&i.setMonth(n[3]-1),n[5]&&i.setDate(n[5]),n[7]&&i.setHours(n[7]),n[8]&&i.setMinutes(n[8]),n[10]&&i.setSeconds(n[10]),n[12]&&i.setMilliseconds(Number("0."+n[12])*1e3),n[14]&&(r=Number(n[16])*60+Number(n[17]),r*=n[15]=="-"?1:-1),r-=i.getTimezoneOffset();var s=Number(i)+r*60*1e3;return new Date(s)};var i=/^(.*?)\b([0-9]{1,4})(?:([\-\/\.\u5e74])([0-9]{1,2}))?(?:([\-\/\.\u6708])([0-9]{1,4}))?((?:\b|[^0-9]).*?)$/,s=/^(.*?)\b((?:circa |around |about |c\.? ?)?[0-9]{1,4}(?: ?B\.? ?C\.?(?: ?E\.?)?| ?C\.? ?E\.?| ?A\.? ?D\.?)|[0-9]{3,4})\b(.*?)$/i,o=null,u=null,p=/^[0-9]{4}\-(0[0-9]|10|11|12)\-(0[0-9]|[1-2][0-9]|30|31) /,d=/^\-?[0-9]{4}\-(0[1-9]|10|11|12)\-(0[1-9]|[1-2][0-9]|30|31)$/,v=/^\-?[0-9]{4}\-(0[0-9]|10|11|12)\-(0[0-9]|[1-2][0-9]|30|31)$/,m=/^\-?[0-9]{4}\-(0[1-9]|10|11|12)\-(0[1-9]|[1-2][0-9]|30|31) ([0-1][0-9]|[2][0-3]):([0-5][0-9]):([0-5][0-9])$/;this.toRelativeDate=function(e){var t,n=new Date,r=n.getTime()-e,i=r/1e3,s=r/1e3/60,o=r/1e3/60/60,u=r/1e3/60/60/24,a=r/1e3/60/60/24/365,f;if(Math.round(i)==1)var l="secondsAgo";else if(s<1.01){var l="secondsAgo";f=Math.round(i)}else if(Math.round(s)==1)var l="minutesAgo";else if(o<1.01){var l="minutesAgo";f=Math.round(s)}else if(Math.round(o)==1)var l="hoursAgo";else if(u<1.01){var l="hoursAgo";f=Math.round(o)}else if(Math.round(u)==1)var l="daysAgo";else if(a<1.01){var l="daysAgo";f=Math.round(u)}else if(Math.round(a)==1)var l="yearsAgo";else var l="yearsAgo",f=Math.round(a);return Zotero.getString("date.relative."+l+"."+(f?"multiple":"one"),f)}},Zotero.HTTP||(Zotero.HTTP={}),Zotero.HTTP.isSameOrigin=function(e){const t=/^([^:\/]+:)\/\/([^\/]+)/i;var n=t.exec(e);if(!n)return!0;var r=Zotero.isConnector?window.parent.location:window.location;return n[1].toLowerCase()===r.protocol.toLowerCase()&&n[2].toLowerCase()===r.host.toLowerCase()},Zotero.HTTP.processDocuments=function(e,t,n,r,i){var s,o=function(){"removeEventListener"in h&&h.removeEventListener("load",l,!1),i||Zotero.Browser.removeHiddenBrowser(h)},u=function(){if(e.length){s=e.shift();try{Zotero.debug("HTTP.processDocuments: Loading "+s);if(Zotero.HTTP.isSameOrigin(s)){h.src=s;if(Zotero.isBookmarklet)var t=window.setInterval(function(){var e;h.contentWindow?e=h.contentWindow:h.contentDocument&&(e=h.contentDocument.window);if(e){if(h.contentWindow.location=="about:blank")return;h.contentWindow.alert=function(){}}window.clearInterval(t)},0)}else{if(Zotero.isBookmarklet)throw"HTTP.processDocuments: Cannot perform cross-site request from "+window.parent.location+" to "+s;Zotero.HTTP.doGet(s,f)}}catch(i){if(r){try{r(i)}catch(i){Zotero.logError(i)}return}Zotero.logError(i),o()}}else{if(n)try{n()}catch(i){Zotero.logError(n)}o()}},a=function(e,n,i){try{if(e==="about:blank")return;Zotero.debug("HTTP.processDocuments: "+e+" has been loaded");if(e!==c){c=e,Zotero.isIE&&installXPathIfNecessary(i);try{t(n,e)}catch(s){Zotero.logError(s)}u()}}catch(s){if(r)try{r(s)}catch(s){Zotero.logError(s)}else Zotero.logError(s);o();return}},f=function(e){var t=document.createElement("iframe");t.style.display="none",t.setAttribute("sandbox","allow-same-origin allow-forms"),document.body.appendChild(t),doc=t.contentDocument,doc.open(),doc.write(e.responseText),doc.close(),a(s,doc,t.contentWindow||t.contentDocument.defaultView)},l=function(){var e=h.contentWindow,t,n;try{e?t=e.document:(t=h.contentDocument,e=t.defaultView),n=t.documentURI||e.location.toString()}catch(i){i="Same origin HTTP request redirected to a different origin not handled";if(r)try{r(i)}catch(i){Zotero.logError(i)}else Zotero.logError(i);o();return}a(n,t,e)};typeof e=="string"&&(e=[e]);var c,h=Zotero.Browser.createHiddenBrowser();return h.addEventListener?h.addEventListener("load",l,!1):h.attachEvent("onload",l),u(),h},Zotero.Browser={createHiddenBrowser:function(){var e=document.createElement("iframe");return Zotero.isBookmarklet||(e.style.display="none"),e.sandbox="allow-same-origin allow-forms allow-scripts",document.body.appendChild(e),e},deleteHiddenBrowser:function(e){document.body.removeChild(e)}},Zotero.OpenURL=new function(){function e(e){var t=n(e,Zotero.Prefs.get("openURL.version"));if(t){var r=Zotero.Prefs.get("openURL.resolver"),i=r.indexOf("?")==-1?"?":"&";return r+i+t}return!1}function t(){var e=Components.classes["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance();e.open("GET","http://worldcatlibraries.org/registry/lookup?IP=requestor",!1),e.send(null);if(!e.responseXML)throw"Could not access resolver registry";var t=new Array,n=e.responseXML.getElementsByTagName("resolver");for(var r=0;r<n.length;r++){var i=n[r],s=i.parentNode.getElementsByTagName("institutionName");if(!s.length)continue;s=s[0].textContent;var o=i.getElementsByTagName("baseURL");if(!o.length)continue;o=o[0].textContent;if(i.getElementsByTagName("Z39.88-2004").length>0)var u="1.0";else{if(!(i.getElementsByTagName("OpenUrl 0.1").length>0))continue;var u="0.1"}t.push({name:s,url:o,version:u})}return t}function n(e,t,n){function i(e,i,s){if(!e)return;t==="1.0"&&!s&&(i="rft."+i),n?(r[i]||(r[i]=[]),r[i].push(e)):r.push(i+"="+encodeURIComponent(e))}var r=n?{}:[];e.toArray&&(e=e.toArray());const s=/(?:\n|^)PMID:\s*(\d+)/g;var o=s.exec(e.extra);o&&(o=o[1]),t=="0.1"?(i("Zotero:2","sid",!0),e.DOI&&i("doi:"+e.DOI,"id",!0),e.ISBN&&i(e.ISBN,"isbn",!0),o&&i("pmid:"+o,"id",!0)):(i("Z39.88-2004","url_ver",!0),i("Z39.88-2004","ctx_ver",!0),i("info:sid/zotero.org:2","rfr_id",!0),e.DOI&&i("info:doi/"+e.DOI,"rft_id",!0),e.ISBN&&i("urn:isbn:"+e.ISBN,"rft_id",!0),o&&i("info:pmid/"+o,"rft_id",!0));if(e.itemType=="journalArticle")t==="1.0"&&i("info:ofi/fmt:kev:mtx:journal","rft_val_fmt",!0),i("article","genre"),e.title&&i(e.title,"atitle"),e.publicationTitle&&i(e.publicationTitle,t=="0.1"?"title":"jtitle"),e.journalAbbreviation&&i(e.journalAbbreviation,"stitle"),e.volume&&i(e.volume,"volume"),e.issue&&i(e.issue,"issue");else if(e.itemType=="book"||e.itemType=="bookSection"||e.itemType=="conferencePaper")t==="1.0"&&i("info:ofi/fmt:kev:mtx:book","rft_val_fmt",!0),e.itemType=="book"?(i("book","genre"),e.title&&i(e.title,t=="0.1"?"title":"btitle")):e.itemType=="conferencePaper"?(i("proceeding","genre"),e.title&&i(e.title,"atitle"),e.proceedingsTitle&&i(e.proceedingsTitle,t=="0.1"?"title":"btitle")):(i("bookitem","genre"),e.title&&i(e.title,"atitle"),e.publicationTitle&&i(e.publicationTitle,t=="0.1"?"title":"btitle")),e.place&&i(e.place,"place"),e.publisher&&i(e.publisher,"publisher"),e.edition&&i(e.edition,"edition"),e.series&&i(e.series,"series");else if(e.itemType=="thesis"&&t=="1.0")i("info:ofi/fmt:kev:mtx:dissertation","rft_val_fmt",!0),e.title&&i(e.title,"title"),e.publisher&&i(e.publisher,"inst"),e.type&&i(e.type,"degree");else{if(e.itemType!="patent"||t!="1.0")return!1;i("info:ofi/fmt:kev:mtx:patent","rft_val_fmt",!0),e.title&&i(e.title,"title"),e.assignee&&i(e.assignee,"assignee"),e.patentNumber&&i(e.patentNumber,"number"),e.issueDate&&i(Zotero.Date.strToISO(e.issueDate),"date")}if(e.creators&&e.creators.length){var u=e.creators[0];e.itemType=="patent"?(i(u.firstName,"invfirst"),i(u.lastName,"invlast")):u.isInstitution?i(u.lastName,"aucorp"):(i(u.firstName,"aufirst"),i(u.lastName,"aulast"));for(var a=0;a<e.creators.length;a++)i((e.creators[a].firstName?e.creators[a].firstName+" ":"")+e.creators[a].lastName,e.itemType=="patent"?"inventor":"au")}e.date&&i(Zotero.Date.strToISO(e.date),e.itemType=="patent"?"appldate":"date");if(e.pages){i(e.pages,"pages");var f=e.pages.split(/[-–]/);f.length>1&&(i(f[0],"spage"),f.length>=2&&i(f[1],"epage"))}return e.numPages&&i(e.numPages,"tpages"),e.ISBN&&i(e.ISBN,"isbn"),e.ISSN&&i(e.ISSN,"issn"),n?r:r.join("&")}function r(e,t){if(!t){var t=new Array;t.creators=new Array}var n=e.split("&");for(var r=0;r<n.length;r++)if(n[r].substr(0,12)=="rft_val_fmt="){var i=decodeURIComponent(n[r].substr(12));if(i=="info:ofi/fmt:kev:mtx:journal"){t.itemType="journalArticle";break}if(i=="info:ofi/fmt:kev:mtx:book"){n.indexOf("rft.genre=bookitem")!==-1?t.itemType="bookSection":n.indexOf("rft.genre=conference")!==-1||n.indexOf("rft.genre=proceeding")!==-1?t.itemType="conferencePaper":n.indexOf("rft.genre=report")!==-1?t.itemType="report":n.indexOf("rft.genre=document")!==-1?t.itemType="document":t.itemType="book";break}if(i=="info:ofi/fmt:kev:mtx:dissertation"){t.itemType="thesis";break}if(i=="info:ofi/fmt:kev:mtx:patent"){t.itemType="patent";break}if(i=="info:ofi/fmt:kev:mtx:dc"){t.itemType="webpage";break}}if(!t.itemType)return!1;var s="",o=new Array;for(var r=0;r<n.length;r++){var u=n[r].split("="),a=u[0],f=decodeURIComponent(u[1].replace(/\+|%2[bB]/g," "));if(!f)continue;if(a=="rft_id"){var l=f.substr(0,8).toLowerCase();l=="info:doi"?t.DOI=f.substr(9):l=="urn:isbn"?t.ISBN=f.substr(9):f.match(/^https?:\/\//)&&(t.url=f,t.accessDate="")}else if(a=="rft.btitle"){if(t.itemType=="book"||t.itemType=="report")t.title=f;else if(t.itemType=="bookSection"||t.itemType=="conferencePaper")t.publicationTitle=f}else if(a=="rft.atitle"&&["journalArticle","bookSection","conferencePaper"].indexOf(t.itemType)!==-1)t.title=f;else if(a=="rft.jtitle"&&t.itemType=="journalArticle")t.publicationTitle=f;else if(a=="rft.stitle"&&t.itemType=="journalArticle")t.journalAbbreviation=f;else if(a=="rft.title")["journalArticle","bookSection","conferencePaper"].indexOf(t.itemType)!==-1?t.publicationTitle=f:t.title=f;else if(a=="rft.date")t.itemType=="patent"?t.issueDate=f:t.date=f;else if(a=="rft.volume")t.volume=f;else if(a=="rft.issue")t.issue=f;else if(a=="rft.pages")s=a,t.pages=f;else if(a=="rft.spage")s!="rft.pages"&&(s=="rft.epage"?f!=t.pages&&(t.pages=f+"-"+t.pages):t.pages=f,s=a);else if(a=="rft.epage")s!="rft.pages"&&(s=="rft.spage"?f!=t.pages&&(t.pages=t.pages+"-"+f):t.pages=f,s=a);else if(a=="rft.issn"||a=="rft.eissn"&&!t.ISSN)t.ISSN=f;else if(a=="rft.aulast"||a=="rft.invlast"){var c=o[o.length-1];o.length&&!c.lastName&&!c.institutional?c.lastName=f:o.push({lastName:f,creatorType:a=="rft.aulast"?"author":"inventor",offset:t.creators.length})}else if(a=="rft.aufirst"||a=="rft.invfirst"){var c=o[o.length-1];o.length&&!c.firstName&&!c.institutional?c.firstName=f:o.push({firstName:f,creatorType:a=="rft.aufirst"?"author":"inventor",offset:t.creators.length})}else if(a=="rft.au"||a=="rft.creator"||a=="rft.contributor"||a=="rft.inventor"){if(a=="rft.contributor")var h="contributor";else if(a=="rft.inventor")var h="inventor";else var h="author";f.indexOf(",")!==-1?t.creators.push(Zotero.Utilities.cleanAuthor(f,h,!0)):t.creators.push(Zotero.Utilities.cleanAuthor(f,h,!1))}else if(a=="rft.aucorp")o.push({lastName:f,isInstitution:!0});else if(a=="rft.isbn"&&!t.ISBN)t.ISBN=f;else if(a=="rft.pub"||a=="rft.publisher")t.publisher=f;else if(a=="rft.place")t.place=f;else if(a=="rft.tpages")t.numPages=f;else if(a=="rft.edition")t.edition=f;else if(a=="rft.series")t.series=f;else if(t.itemType=="thesis")a=="rft.inst"?t.publisher=f:a=="rft.degree"&&(t.type=f);else if(t.itemType=="patent")a=="rft.assignee"?t.assignee=f:a=="rft.number"?t.patentNumber=f:a=="rft.appldate"&&(t.date=f);else if(i=="info:ofi/fmt:kev:mtx:dc")if(a=="rft.identifier"){if(f.length>8)if(f.substr(0,5)=="ISBN ")t.ISBN=f.substr(5);else if(f.substr(0,5)=="ISSN ")t.ISSN=f.substr(5);else if(f.substr(0,8)=="urn:doi:")t.DOI=f.substr(4);else if(f.substr(0,7)=="http://"||f.substr(0,8)=="https://")t.url=f}else a=="rft.description"?t.abstractNote=f:a=="rft.rights"?t.rights=f:a=="rft.language"?t.language=f:a=="rft.subject"?t.tags.push(f):a=="rft.type"?Zotero.Utilities.itemTypeExists(f)&&(t.itemType=f):a=="rft.source"&&(t.publicationTitle=f)}var p=0;for(var r=0;r<o.length;r++){var d=!0,v=o[r].offset;delete o[r].offset;for(var m=0;m<t.creators.length;m++)if(t.creators[m].lastName==o[r].lastName&&(t.creators[m].firstName==o[r].firstName==""||t.creators[m].firstName.length>=o[r].firstName.length&&t.creators[m].firstName.substr(0,o[r].firstName.length)==o[r].firstName)){d=!1;break}d&&(t.creators.splice(v+p,0,o[r]),p++)}return t}this.resolve=e,this.discoverResolvers=t,this.createContextObject=n,this.parseContextObject=r};const cssDivClearString='background-attachment: scroll; background-color: transparent; background-image: none; background-position: 0% 0%; background-repeat: repeat; border-bottom-color: rgb(0, 0, 0); border-bottom-style: none; border-bottom-width: 0px; border-collapse: separate; border-left-color: rgb(0, 0, 0); border-left-style: none; border-left-width: 0px; border-right-color: rgb(0, 0, 0); border-right-style: none; border-right-width: 0px; border-spacing: 0px 0px; border-top-color: rgb(0, 0, 0); border-top-style: none; border-top-width: 0px; bottom: auto; caption-side: top; clear: none; clip: auto; color: rgb(0, 0, 0); content: none; counter-increment: none; counter-reset: none; cursor: auto; direction: ltr; display: block; empty-cells: show; float: none; font-family: serif; font-size: 16px; font-size-adjust: none; font-stretch: normal; font-style: normal; font-variant: normal; font-weight: 400; left: auto; letter-spacing: normal; line-height: normal; list-style-image: none; list-style-position: outside; list-style-type: disc; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; marker-offset: auto; max-height: none; max-width: none; min-height: 0px; min-width: 0px; ime-mode: auto; opacity: 1; outline-color: rgb(0, 0, 0); outline-style: none; outline-width: 0px; outline-offset: 0px; overflow: visible; overflow-x: visible; overflow-y: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; page-break-after: auto; page-break-before: auto; pointer-events: auto; position: static; quotes: "“" "”" "‘" "’"; right: auto; table-layout: auto; text-align: left; text-decoration: none; text-indent: 0px; text-shadow: none; text-transform: none; top: auto; unicode-bidi: embed; vertical-align: baseline; visibility: visible; white-space: normal; word-spacing: 0px; z-index: auto; background-clip: border-box; background-origin: padding-box; background-size: auto auto; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; box-shadow: none; resize: none; word-wrap: normal; clip-path: none; clip-rule: nonzero; color-interpolation: srgb; color-interpolation-filters: linearrgb; dominant-baseline: auto; fill: rgb(0, 0, 0); fill-opacity: 1; fill-rule: nonzero; filter: none; flood-color: rgb(0, 0, 0); flood-opacity: 1; lighting-color: rgb(255, 255, 255); image-rendering: auto; mask: none; marker-end: none; marker-mid: none; marker-start: none; shape-rendering: auto; stop-color: rgb(0, 0, 0); stop-opacity: 1; stroke: none; stroke-dasharray: none; stroke-dashoffset: 0px; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 4; stroke-opacity: 1; stroke-width: 1px; text-anchor: start; text-rendering: auto;',cssAClearString='background-attachment: scroll; background-color: transparent; background-image: none; background-position: 0% 0%; background-repeat: repeat; border-bottom-color: rgb(0, 0, 238); border-bottom-style: none; border-bottom-width: 0px; border-collapse: separate; border-left-color: rgb(0, 0, 238); border-left-style: none; border-left-width: 0px; border-right-color: rgb(0, 0, 238); border-right-style: none; border-right-width: 0px; border-spacing: 0px 0px; border-top-color: rgb(0, 0, 238); border-top-style: none; border-top-width: 0px; bottom: auto; caption-side: top; clear: none; clip: auto; color: rgb(0, 0, 238); content: none; counter-increment: none; counter-reset: none; cursor: pointer; direction: ltr; display: inline; empty-cells: show; float: none; font-family: serif; font-size: 16px; font-size-adjust: none; font-stretch: normal; font-style: normal; font-variant: normal; font-weight: 400; height: auto; left: auto; letter-spacing: normal; line-height: normal; list-style-image: none; list-style-position: outside; list-style-type: disc; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; marker-offset: auto; max-height: none; max-width: none; min-height: 0px; min-width: 0px; ime-mode: auto; opacity: 1; outline-color: rgb(0, 0, 0); outline-style: none; outline-width: 0px; outline-offset: 0px; overflow: visible; overflow-x: visible; overflow-y: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; page-break-after: auto; page-break-before: auto; pointer-events: auto; position: static; quotes: "“" "”" "‘" "’"; right: auto; table-layout: auto; text-align: left; text-decoration: underline; text-indent: 0px; text-shadow: none; text-transform: none; top: auto; unicode-bidi: normal; vertical-align: baseline; visibility: visible; white-space: normal; width: auto; word-spacing: 0px; z-index: auto; background-clip: border-box; background-origin: padding-box; background-size: auto auto; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; box-shadow: none; resize: none; word-wrap: normal; clip-path: none; clip-rule: nonzero; color-interpolation: srgb; color-interpolation-filters: linearrgb; dominant-baseline: auto; fill: rgb(0, 0, 0); fill-opacity: 1; fill-rule: nonzero; filter: none; flood-color: rgb(0, 0, 0); flood-opacity: 1; lighting-color: rgb(255, 255, 255); image-rendering: auto; mask: none; marker-end: none; marker-mid: none; marker-start: none; shape-rendering: auto; stop-color: rgb(0, 0, 0); stop-opacity: 1; stroke: none; stroke-dasharray: none; stroke-dashoffset: 0px; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 4; stroke-opacity: 1; stroke-width: 1px; text-anchor: start; text-rendering: auto;';Zotero.ProgressWindow=new function(){const e={position:Zotero.isIE&&document.compatMode==="BackCompat"?"absolute":"fixed",right:"25px",bottom:"25px",width:"240px",borderWidth:"2px",borderStyle:"solid",borderColor:"#7a0000",backgroundColor:"#ededed",opacity:"0.9",filter:"alpha(opacity = 90)",zIndex:"16777269",padding:"6px 6px 6px 6px",minHeight:"40px"},t={fontFamily:"Lucida Grande, Tahoma, sans",fontSize:"11px",fontWeight:"bold",marginBottom:"6px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},n={display:"none",width:"16px",height:"16px",backgroundPosition:"center",backgroundRepeat:"no-repeat",verticalAlign:"-3px"},r={fontSize:"11px",margin:"4px 0 4px 0"},i={position:"absolute",fontSize:"11px",width:"16px",height:"16px",backgroundPosition:"0",backgroundRepeat:"no-repeat"},s={fontFamily:"Lucida Grande, Tahoma, sans",fontSize:"11px",verticalAlign:"middle",overflow:"hidden",whiteSpace:"nowrap",lineHeight:"16px",margin:"0 0 0 20px"},o={fontFamily:"Lucida Grande, Tahoma, sans",fontSize:"11px",lineHeight:"1.4em",marginBottom:"4px"};if(Zotero.isBookmarklet)var u=ZOTERO_CONFIG.BOOKMARKLET_URL+"images/";else if(Zotero.isChrome)var u=chrome.extension.getURL("images/");else if(Zotero.isSafari)var u=safari.extension.baseURI+"images/";const a=20;var f=Zotero.isBookmarklet?window.parent:window,l=Zotero.isBookmarklet?window.parent.document:window.document,c,h,p,d,v,m;this.ItemProgress=function(e,t,n){Zotero.ProgressWindow.show(),this._div=l.createElement("div"),this._div.className="zotero-item-progress",this._div.style.cssText=cssDivClearString;for(var o in r)this._div.style[o]=r[o];this._div.style.opacity="0.5",this._div.style.filter="alpha(opacity = 50)",this._div.style.zoom="1",n&&(this._div.style.marginLeft="12px"),this._image=l.createElement("div"),this._image.style.cssText=cssDivClearString;for(var o in i)this._image.style[o]=i[o];n?(this._div.zoteroIsChildItem=!0,this._image.style.left="18px"):this._image.style.left="6px",this.setIcon(e),this._div.appendChild(this._image),this._itemText=l.createElement("div"),this._itemText.style.cssText=cssDivClearString;for(var o in s)this._itemText.style[o]=s[o];Zotero.isIE?this._itemText.appendChild(l.createTextNode(t.substr(0,n?30:35)+"…")):(this._itemText.style.textOverflow="ellipsis",this._itemText.appendChild(l.createTextNode(t))),this._div.appendChild(this._itemText);if(n){var u=n._div.nextSibling;while(u&&u.zoteroIsChildItem)u=u.nextSibling;c.insertBefore(this._div,u)}else c.appendChild(this._div)},this.ItemProgress.prototype.setProgress=function(e){e!=0&&e!=100?(this._image.style.backgroundImage="url('"+u+"progress_arcs.png')",this._image.style.backgroundPosition="-"+Math.round(e/100*a)*16+"px 0",this._div.style.opacity=e/200+.5,this._div.style.filter="alpha(opacity = "+(e/2+50)+")"):e==100&&(this._image.style.backgroundImage="url('"+this._iconSrc+"')",this._image.style.backgroundPosition="",this._div.style.opacity="1",this._div.style.filter="")},this.ItemProgress.prototype.setIcon=function(e){this._image.style.backgroundImage="url('"+e+"')",this._image.style.backgroundPosition="",this._iconSrc=e},this.ItemProgress.prototype.setError=function(){this._image.style.backgroundImage="url('"+u+"cross.png')",this._image.style.backgroundPosition="",this._itemText.style.color="red",this._div.style.opacity="1",this._div.style.filter=""
},this.ErrorMessage=function(e){Zotero.ProgressWindow.show(),this._div=l.createElement("div"),this._div.style.cssText=cssDivClearString;for(var t in o)this._div.style[t]=o[t];if(e==="translationError"){this._div.appendChild(l.createTextNode("An error occurred while saving this item. Check "));var n=l.createElement("a");n.style.cssText=cssAClearString;for(var t in o)n.style[t]=o[t];n.title=n.href="http://www.zotero.org/documentation/known_translator_issues",n.appendChild(l.createTextNode("Known Translator Issues")),this._div.appendChild(n),this._div.appendChild(l.createTextNode(" for more information."))}else if(e==="noTranslator"){var r=l.createTextNode("No items could be saved because this website is not supported by any Zotero translator. If Zotero Standalone is not open, try opening it to increase the number of supported sites.");this._div.appendChild(r)}else e==="standaloneRequired"&&this._div.appendChild(l.createTextNode("This item could not be saved because Zotero Standalone is not open or unreachable. Please open Zotero Standalone and try again."));c.appendChild(this._div)},this.show=function(){if(c)return;c=l.createElement("div"),c.style.cssText=cssDivClearString;for(var r in e)c.style[r]=e[r];p=l.createElement("div"),p.style.cssText=cssDivClearString;for(var r in t)p.style[r]=t[r];d=l.createTextNode("Saving Item"),p.appendChild(d),m=l.createElement("div"),m.style.cssText=cssDivClearString;for(var i in n)m.style[i]=n[i];p.appendChild(m),v=l.createTextNode("…"),p.appendChild(v),c.appendChild(p),l.body.appendChild(c)},this.changeHeadline=function(e,t,n){d.nodeValue=e,t?(m.style.display="inline-block",m.style.backgroundImage="url('"+u+t+"')"):m.style.display="none",n!==undefined&&(v.nodeValue=" "+n)},this.startCloseTimer=function(e){if(!c)return;e||(e=2500),h&&f.clearTimeout(h),h=f.setTimeout(Zotero.ProgressWindow.close,e)},this.close=function(){if(!c)return;l.body.removeChild(c),c=void 0,h&&f.clearTimeout(h),h=void 0}};var $rdf={Util:{ArrayIndexOf:function(e,t,n){return e.indexOf(t,n)},RDFArrayRemove:function(e,t){for(var n=0;n<e.length;n++)if(e[n].subject.sameTerm(t.subject)&&e[n].predicate.sameTerm(t.predicate)&&e[n].object.sameTerm(t.object)&&e[n].why.sameTerm(t.why)){e.splice(n,1);return}throw"RDFArrayRemove: Array did not contain "+t}},log:{debug:Zotero.debug,warn:Zotero.debug,error:Zotero.debug}};Zotero.RDF?Zotero.RDF.AJAW=$rdf:Zotero.RDF={AJAW:$rdf};var tabulator={log:$rdf.log},alert=$rdf.log.warn;typeof $rdf.Util.uri=="undefined"&&($rdf.Util.uri={}),$rdf.Util.uri.join=function(e,t){var n=t.indexOf("#");n>0&&(t=t.slice(0,n));if(e.length==0)return t;if(e.indexOf("#")==0)return t+e;var r=e.indexOf(":");if(r>=0)return e;var i=t.indexOf(":");if(t=="")return e;if(i<0)return alert("Invalid base: "+t+" in join with "+e),e;var s=t.slice(0,i+1);if(e.indexOf("//")==0)return s+e;if(t.indexOf("//",i)==i+1){var o=t.indexOf("/",i+3);if(o<0)return t.length-i-3>0?t+"/"+e:s+e}else{var o=t.indexOf("/",i+1);if(o<0)return t.length-i-1>0?t+"/"+e:s+e}if(e.indexOf("/")==0)return t.slice(0,o)+e;var u=t.slice(o),a=u.lastIndexOf("/");if(a<0)return s+e;a>=0&&a<u.length-1&&(u=u.slice(0,a+1)),u+=e;while(u.match(/[^\/]*\/\.\.\//))u=u.replace(/[^\/]*\/\.\.\//,"");return u=u.replace(/\.\//g,""),u=u.replace(/\/\.$/,"/"),t.slice(0,o)+u},typeof tabulator!="undefined"&&tabulator.isExtension?$rdf.Util.uri.join2=function(e,t){var n=Components.classes["@mozilla.org/network/io-service;1"].getService(Components.interfaces.nsIIOService),r=n.newURI(t,null,null);return n.newURI(r.resolve(e),null,null).spec}:$rdf.Util.uri.join2=$rdf.Util.uri.join,$rdf.Util.uri.commonHost=new RegExp("^[-_a-zA-Z0-9.]+:(//[^/]*)?/[^/]*$"),$rdf.Util.uri.hostpart=function(e){var t=/[^\/]*\/\/([^\/]*)\//.exec(e);return t?t[1]:""},$rdf.Util.uri.refTo=function(e,t){if(!e)return t;if(e==t)return"";var n=0;while(n<t.length&&n<e.length){if(t[n]!=e[n])break;n++}if(e.slice(0,n).match($rdf.Util.uri.commonHost)){var r=t.indexOf("//");r<0&&(r=-2);var i=t.indexOf("/",r+2);if(t.slice(i+1,i+2)!="/"&&e.slice(i+1,i+2)!="/"&&t.slice(0,i)==e.slice(0,i))return t.slice(i)}if(t.slice(n,n+1)=="#"&&e.length==n)return t.slice(n);while(n>0&&t[n-1]!="/")n--;if(n<3)return t;if(e.indexOf("//",n-2)>0||t.indexOf("//",n-2)>0)return t;if(e.indexOf(":",n)>0)return t;var s=0;for(var o=n;o<e.length;o++)e[o]=="/"&&s++;if(s==0&&n<t.length&&t[n]=="#")return"./"+t.slice(n);if(s==0&&n==t.length)return"./";var u="";for(var o=0;o<s;o++)u+="../";return u+t.slice(n)},$rdf.Util.uri.docpart=function(e){var t=e.indexOf("#");return t<0?e:e.slice(0,t)},$rdf.Util.uri.document=function(e){return $rdf.sym($rdf.Util.uri.docpart(e.uri))},$rdf.Util.uri.protocol=function(e){var t=e.indexOf(":");return t>=0?e.slice(0,t):null},$rdf.Empty=function(){return this},$rdf.Empty.prototype.termType="empty",$rdf.Empty.prototype.toString=function(){return"()"},$rdf.Empty.prototype.toNT=$rdf.Empty.prototype.toString,$rdf.Symbol=function(e){return this.uri=e,this.value=e,this},$rdf.Symbol.prototype.termType="symbol",$rdf.Symbol.prototype.toString=function(){return"<"+this.uri+">"},$rdf.Symbol.prototype.toNT=$rdf.Symbol.prototype.toString,$rdf.Symbol.prototype.XSDboolean=new $rdf.Symbol("http://www.w3.org/2001/XMLSchema#boolean"),$rdf.Symbol.prototype.XSDdecimal=new $rdf.Symbol("http://www.w3.org/2001/XMLSchema#decimal"),$rdf.Symbol.prototype.XSDfloat=new $rdf.Symbol("http://www.w3.org/2001/XMLSchema#float"),$rdf.Symbol.prototype.XSDinteger=new $rdf.Symbol("http://www.w3.org/2001/XMLSchema#integer"),$rdf.Symbol.prototype.XSDdateTime=new $rdf.Symbol("http://www.w3.org/2001/XMLSchema#dateTime"),$rdf.Symbol.prototype.integer=new $rdf.Symbol("http://www.w3.org/2001/XMLSchema#integer"),typeof $rdf.NextId!="undefined"?$rdf.log.error("Attempt to re-zero existing blank node id counter at "+$rdf.NextId):$rdf.NextId=0,$rdf.NTAnonymousNodePrefix="_:n",$rdf.BlankNode=function(e){return this.id=$rdf.NextId++,this.value=e?e:this.id.toString(),this},$rdf.BlankNode.prototype.termType="bnode",$rdf.BlankNode.prototype.toNT=function(){return $rdf.NTAnonymousNodePrefix+this.id},$rdf.BlankNode.prototype.toString=$rdf.BlankNode.prototype.toNT,$rdf.Literal=function(e,t,n){return this.value=e,t==""||t==null?this.lang=undefined:this.lang=t,n==null?this.datatype=undefined:this.datatype=n,this},$rdf.Literal.prototype.termType="literal",$rdf.Literal.prototype.toString=function(){return""+this.value},$rdf.Literal.prototype.toNT=function(){var e=this.value;if(typeof e!="string"){if(typeof e=="number")return""+e;throw Error("Value of RDF literal is not string: "+e)}return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\"/g,'\\"'),e=e.replace(/\n/g,"\\n"),e='"'+e+'"',this.datatype&&(e=e+"^^"+this.datatype.toNT()),this.lang&&(e=e+"@"+this.lang),e},$rdf.Collection=function(){this.id=$rdf.NextId++,this.elements=[],this.closed=!1},$rdf.Collection.prototype.termType="collection",$rdf.Collection.prototype.toNT=function(){return $rdf.NTAnonymousNodePrefix+this.id},$rdf.Collection.prototype.toString=function(){var e="(";for(var t=0;t<this.elements.length;t++)e+=this.elements[t]+" ";return e+")"},$rdf.Collection.prototype.append=function(e){this.elements.push(e)},$rdf.Collection.prototype.unshift=function(e){this.elements.unshift(e)},$rdf.Collection.prototype.shift=function(){return this.elements.shift()},$rdf.Collection.prototype.close=function(){this.closed=!0},$rdf.term=function(e){if(typeof e=="object"){if(e instanceof Date){var t=function(e){return(""+(100+e)).slice(1,3)};return new $rdf.Literal(""+e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z",undefined,$rdf.Symbol.prototype.XSDdateTime)}if(e instanceof Array){var n=new $rdf.Collection;for(var r=0;r<e.length;r++)n.append($rdf.term(e[r]));return n}return e}if(typeof e=="string")return new $rdf.Literal(e);if(typeof e=="number"){var i;return(""+e).indexOf("e")>=0?i=$rdf.Symbol.prototype.XSDfloat:(""+e).indexOf(".")>=0?i=$rdf.Symbol.prototype.XSDdecimal:i=$rdf.Symbol.prototype.XSDinteger,new $rdf.Literal(e,undefined,i)}if(typeof e=="boolean")return new $rdf.Literal(e?"1":"0",undefined,$rdf.Symbol.prototype.XSDboolean);if(typeof e=="undefined")return undefined;throw"Can't make term from "+e+" of type "+typeof e},$rdf.Statement=function(e,t,n,r){return this.subject=$rdf.term(e),this.predicate=$rdf.term(t),this.object=$rdf.term(n),typeof r!="undefined"&&(this.why=r),this},$rdf.st=function(e,t,n,r){return new $rdf.Statement(e,t,n,r)},$rdf.Statement.prototype.toNT=function(){return this.subject.toNT()+" "+this.predicate.toNT()+" "+this.object.toNT()+" ."},$rdf.Statement.prototype.toString=$rdf.Statement.prototype.toNT,$rdf.Formula=function(){return this.statements=[],this.constraints=[],this.initBindings=[],this.optional=[],this},$rdf.Formula.prototype.termType="formula",$rdf.Formula.prototype.toNT=function(){return"{"+this.statements.join("\n")+"}"},$rdf.Formula.prototype.toString=$rdf.Formula.prototype.toNT,$rdf.Formula.prototype.add=function(e,t,n,r){this.statements.push(new $rdf.Statement(e,t,n,r))},$rdf.Formula.prototype.sym=function(e,t){if(t!=null)throw"This feature (kb.sym with 2 args) is removed. Do not assume prefix mappings.";return new $rdf.Symbol(e)},$rdf.sym=function(e){return new $rdf.Symbol(e)},$rdf.Formula.prototype.literal=function(e,t,n){return new $rdf.Literal(e.toString(),t,n)},$rdf.lit=$rdf.Formula.prototype.literal,$rdf.Formula.prototype.bnode=function(e){return new $rdf.BlankNode(e)},$rdf.Formula.prototype.formula=function(){return new $rdf.Formula},$rdf.Formula.prototype.collection=function(){return new $rdf.Collection},$rdf.Formula.prototype.list=function(e){var t=new $rdf.Collection;if(e)for(var n=0;n<e.length;n++)t.append(e[n]);return t},$rdf.Variable=function(e){return this.base="varid:",this.uri=$rdf.Util.uri.join(e,this.base),this},$rdf.Variable.prototype.termType="variable",$rdf.Variable.prototype.toNT=function(){return this.uri.slice(0,this.base.length)==this.base?"?"+this.uri.slice(this.base.length):"?"+this.uri},$rdf.Variable.prototype.toString=$rdf.Variable.prototype.toNT,$rdf.Variable.prototype.classOrder=7,$rdf.variable=$rdf.Formula.prototype.variable=function(e){return new $rdf.Variable(e)},$rdf.Variable.prototype.hashString=$rdf.Variable.prototype.toNT,$rdf.Namespace=function(e){return function(t){return new $rdf.Symbol(e+(t===undefined?"":t))}},$rdf.Formula.prototype.ns=function(e){return function(t){return new $rdf.Symbol(e+(t===undefined?"":t))}},$rdf.Formula.prototype.fromNT=function(e){var t=e.length,n=e.slice(0,1);if(n=="<")return $rdf.sym(e.slice(1,t-1));if(n=='"'){var r=undefined,i=undefined,s=e.lastIndexOf('"');if(s<t-1)if(e[s+1]=="@")r=e.slice(s+2,t);else{if(e.slice(s+1,s+3)!="^^")throw"Can't convert string from NT: "+e;i=$rdf.fromNT(e.slice(s+3,t))}var e=e.slice(1,s);return e=e.replace(/\\"/g,'"'),e=e.replace(/\\n/g,"\n"),e=e.replace(/\\\\/g,"\\"),$rdf.lit(e,r,i)}if(n=="_"){var o=new $rdf.BlankNode;return o.id=parseInt(e.slice(3)),$rdf.NextId--,o}if(n=="?"){var o=new $rdf.Variable(e.slice(1));return o}throw"Can't convert from NT: "+e},$rdf.fromNT=$rdf.Formula.prototype.fromNT,$rdf.graph=function(){return new $rdf.IndexedFormula},$rdf.IndexedFormula=function(){function t(e,t,n){if(typeof t!="object"){if(typeof t=="string")return new $rdf.Literal(t);if(typeof t=="number")return new $rdf.Literal(t);if(typeof t=="boolean")return new $rdf.Literal(t?"1":"0",undefined,$rdf.Symbol.prototype.XSDboolean);if(typeof t=="undefined")return undefined;throw"Can't make Term from "+t+" of type "+typeof t}return t}var e="http://www.w3.org/2002/07/owl#";return $rdf.Literal.prototype.hashString=$rdf.Literal.prototype.toNT,$rdf.Symbol.prototype.hashString=$rdf.Symbol.prototype.toNT,$rdf.BlankNode.prototype.hashString=$rdf.BlankNode.prototype.toNT,$rdf.Collection.prototype.hashString=$rdf.Collection.prototype.toNT,$rdf.IndexedFormula=function(t){function n(e,t,n,r,i){e.typeCallback!=undefined&&e.typeCallback(e,r,i);var s=e.classActions[r.hashString()],o=!1;if(s)for(var u=0;u<s.length;u++)o=o||s[u](e,t,n,r,i);return o}function r(e,t,n,r){var i=e.any(undefined,n,r);return i==undefined?!1:(e.equate(i,t),!0)}function i(e,t,n,r){var i=e.any(t,n,undefined);return i==undefined?!1:(e.equate(i,r),!0)}this.statements=[],this.optional=[],this.propertyActions=[],this.classActions=[],this.redirections=[],this.aliases=[],this.HTTPRedirects=[],this.subjectIndex=[],this.predicateIndex=[],this.objectIndex=[],this.whyIndex=[],this.index=[this.subjectIndex,this.predicateIndex,this.objectIndex,this.whyIndex],this.namespaces={},t===undefined&&(t=["sameAs","InverseFunctionalProperty","FunctionalProperty"]),this.propertyActions["<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"]=[n],$rdf.Util.ArrayIndexOf(t,"sameAs")>=0&&(this.propertyActions["<http://www.w3.org/2002/07/owl#sameAs>"]=[function(e,t,n,r,i){return e.equate(t,r),!0}]),$rdf.Util.ArrayIndexOf(t,"InverseFunctionalProperty")>=0&&(this.classActions["<"+e+"InverseFunctionalProperty>"]=[function(e,t,n,i,s){return e.newPropertyAction(t,r)}]),$rdf.Util.ArrayIndexOf(t,"FunctionalProperty")>=0&&(this.classActions["<"+e+"FunctionalProperty>"]=[function(e,t,n,r,s){return e.newPropertyAction(t,i)}])},$rdf.IndexedFormula.prototype=new $rdf.Formula,$rdf.IndexedFormula.prototype.constructor=$rdf.IndexedFormula,$rdf.IndexedFormula.SuperClass=$rdf.Formula,$rdf.IndexedFormula.prototype.newPropertyAction=function(t,n){var r=t.hashString();this.propertyActions[r]==undefined&&(this.propertyActions[r]=[]),this.propertyActions[r].push(n);var i=this.statementsMatching(undefined,t,undefined),s=!1;for(var o=0;o<i.length;o++)s=s||n(this,i[o].subject,t,i[o].object);return s},$rdf.IndexedFormula.prototype.setPrefixForURI=function(e,t){if(e=="tab"&&this.namespaces.tab)return;this.namespaces[e]=t},$rdf.IndexedFormula.prototype.register=function(e,t){this.namespaces[e]=t},$rdf.IndexedFormula.prototype.equate=function(e,t){e=this.canon(e),t=this.canon(t);var n=e.compareTerm(t);if(!n)return!0;var r,i;return n<0?this.replaceWith(t,e):this.replaceWith(e,t)},$rdf.IndexedFormula.prototype.replaceWith=function(e,t){var n=e.hashString(),r=t.hashString(),i=function(e){var t=e[n];if(t==undefined)return;var i=e[r];i==undefined?e[r]=t:e[r]=t.concat(i),delete e[n]};for(var s=0;s<4;s++)i(this.index[s]);this.redirections[n]=t;if(e.uri){this.aliases[r]==undefined&&(this.aliases[r]=[]),this.aliases[r].push(e);if(this.aliases[n])for(var s=0;s<this.aliases[n].length;s++)this.redirections[this.aliases[n][s].hashString()]=t,this.aliases[r].push(this.aliases[n][s]);this.sf&&this.sf.nowKnownAs(e,t)}return i(this.classActions),i(this.propertyActions),$rdf.log.debug("Equate done. "+e+" now links to "+t),!0},$rdf.IndexedFormula.prototype.canon=function(e){if(e==undefined)return e;var t=this.redirections[e.hashString()];return t==undefined?e:t},$rdf.IndexedFormula.prototype.sameThings=function(e,t){if(e.sameTerm(t))return!0;var n=this.canon(e);if(n==undefined)return!1;var r=this.canon(t);return r==undefined?!1:n.uri==r.uri},$rdf.IndexedFormula.prototype.uris=function(e){var t=this.canon(e),n=this.aliases[t.hashString()];if(!t.uri)return[];var r=[t.uri];if(n!=undefined)for(var i=0;i<n.length;i++)r.push(n[i].uri);return r},$rdf.IndexedFormula.prototype.add=function(e,n,r,i){var s,o;i==undefined&&(i=this.fetcher?this.fetcher.appNode:this.sym("chrome:theSession")),e=t(this,e),n=t(this,n),r=t(this,r),i=t(this,i),this.predicateCallback!=undefined&&this.predicateCallback(this,n,i);var s=this.propertyActions[this.canon(n).hashString()],u=!1;if(s)for(var a=0;a<s.length;a++)u=u||s[a](this,e,n,r,i);var f=[this.canon(e).hashString(),this.canon(n).hashString(),this.canon(r).hashString(),this.canon(i).hashString()],o=new $rdf.Statement(e,n,r,i);for(var a=0;a<4;a++){var l=this.index[a],c=f[a];l[c]==undefined&&(l[c]=[]),l[c].push(o)}return this.statements.push(o),o},$rdf.IndexedFormula.prototype.mentionsURI=function(e){var t="<"+e+">";return!!this.subjectIndex[t]||!!this.objectIndex[t]||!!this.predicateIndex[t]},$rdf.IndexedFormula.prototype.nextSymbol=function(e){for(var t=0;;t++){var n=e.uri+"#n"+t;if(!this.mentionsURI(n))return this.sym(n)}},$rdf.IndexedFormula.prototype.anyStatementMatching=function(e,t,n,r){var i=this.statementsMatching(e,t,n,r,!0);return!i||i==[]?undefined:i[0]},$rdf.IndexedFormula.prototype.statementsMatching=function(e,n,r,i,s){var o=[e,n,r,i],u=[],a=[],f=[],l=[];for(var c=0;c<4;c++)u[c]=this.canon(t(this,o[c])),u[c]==undefined?f.push(c):(l.push(c),a[c]=u[c].hashString());if(l.length==0)return this.statements;if(l.length==1){var c=l[0],h=this.index[c][a[c]];return h&&s&&h.length>1&&(h=h.slice(0,1)),h==undefined?[]:h}var p=1e10,d;for(var v=0;v<l.length;v++){var c=l[v],h=this.index[c][a[c]];if(h==undefined)return[];h.length<p&&(p=h.length,d=v)}var m=l[d],g=this.index[m][a[m]],y=l.slice(0,d).concat(l.slice(d+1)),b=[],w=["subject","predicate","object","why"];for(var E=0;E<g.length;E++){var S=g[E];for(var v=0;v<y.length;v++){var c=y[v];if(!this.canon(S[w[c]]).sameTerm(u[c])){S=null;break}}if(S!=null){b.push(S);if(s)break}}return b},$rdf.IndexedFormula.prototype.remove=function(e){var t=[e.subject,e.predicate,e.object,e.why];for(var n=0;n<4;n++){var r=this.canon(t[n]),i=r.hashString();this.index[n][i]!=undefined&&$rdf.Util.RDFArrayRemove(this.index[n][i],e)}$rdf.Util.RDFArrayRemove(this.statements,e)},$rdf.IndexedFormula.prototype.removeMany=function(e,t,n,r,i){var s=this.statementsMatching(e,t,n,r,!1),o=[];for(var u=0;u<s.length;u++)o.push(s[u]);i&&(o=o.slice(0,i));for(var u=0;u<o.length;u++)this.remove(o[u])},$rdf.IndexedFormula.prototype.copyTo=function(e,t,n){n||(n=[]);var r=this.statementsMatching(e);$rdf.Util.ArrayIndexOf(n,"two-direction")!=-1&&r.concat(this.statementsMatching(undefined,undefined,e));for(var i=0;i<r.length;i++){var s=r[i];switch(s.object.termType){case"symbol":this.add(t,s.predicate,s.object);break;case"literal":case"bnode":case"collection":this.add(t,s.predicate,s.object.copy(this))}$rdf.Util.ArrayIndexOf(n,"delete")!=-1&&this.remove(s)}},$rdf.Literal.prototype.copy=function(){return new $rdf.Literal(this.value,this.lang,this.datatype)},$rdf.BlankNode.prototype.copy=function(e){var t=new $rdf.BlankNode;return e.copyTo(this,t),t},$rdf.IndexedFormula.prototype.newUniversal=function(e){var t=this.sym(e);return this._universalVariables||(this._universalVariables=[]),this._universalVariables.push(t),t},$rdf.IndexedFormula.prototype.newExistential=function(e){if(!e)return this.bnode();var t=this.sym(e);return this.declareExistential(t)},$rdf.IndexedFormula.prototype.declareExistential=function(e){return this._existentialVariables||(this._existentialVariables=[]),this._existentialVariables.push(e),e},$rdf.IndexedFormula.prototype.formula=function(e){return new $rdf.IndexedFormula(e)},$rdf.IndexedFormula.prototype.close=function(){return this},$rdf.IndexedFormula.prototype.hashString=$rdf.IndexedFormula.prototype.toNT,$rdf.IndexedFormula}(),$rdf.Symbol.prototype.sameTerm=function(e){return e?this.termType==e.termType&&this.uri==e.uri:!1},$rdf.BlankNode.prototype.sameTerm=function(e){return e?this.termType==e.termType&&this.id==e.id:!1},$rdf.Literal.prototype.sameTerm=function(e){return e?this.termType==e.termType&&this.value==e.value&&this.lang==e.lang&&(!this.datatype&&!e.datatype||this.datatype&&this.datatype.sameTerm(e.datatype)):!1},$rdf.Variable.prototype.sameTerm=function(e){return e?this.termType==e.termType&&this.uri==e.uri:!1},$rdf.Collection.prototype.sameTerm=$rdf.BlankNode.prototype.sameTerm,$rdf.Formula.prototype.sameTerm=function(e){return this.hashString()==e.hashString()},$rdf.Literal.prototype.classOrder=1,$rdf.Collection.prototype.classOrder=3,$rdf.Formula.prototype.classOrder=4,$rdf.Symbol.prototype.classOrder=5,$rdf.BlankNode.prototype.classOrder=6,$rdf.Literal.prototype.compareTerm=function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.value<e.value?-1:this.value>e.value?1:0},$rdf.Symbol.prototype.compareTerm=function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.uri<e.uri?-1:this.uri>e.uri?1:0},$rdf.BlankNode.prototype.compareTerm=function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.id<e.id?-1:this.id>e.id?1:0},$rdf.Collection.prototype.compareTerm=$rdf.BlankNode.prototype.compareTerm,$rdf.Formula.prototype.each=function(e,t,n,r){var i=[],s,o=this.statementsMatching(e,t,n,r,!1),u,a=o.length;if(typeof e=="undefined")for(u=0;u<a;u++)s=o[u],i.push(s.subject);else if(typeof t=="undefined")for(u=0;u<a;u++)s=o[u],i.push(s.predicate);else if(typeof n=="undefined")for(u=0;u<a;u++)s=o[u],i.push(s.object);else if(typeof r=="undefined")for(u=0;u<a;u++)s=o[u],i.push(s.why);return i},$rdf.Formula.prototype.any=function(e,t,n,r){var i=this.anyStatementMatching(e,t,n,r);return typeof i=="undefined"?undefined:typeof e=="undefined"?i.subject:typeof t=="undefined"?i.predicate:typeof n=="undefined"?i.object:undefined},$rdf.Formula.prototype.holds=function(e,t,n,r){var i=this.anyStatementMatching(e,t,n,r);return typeof i=="undefined"?!1:!0},$rdf.Formula.prototype.the=function(e,t,n,r){var i=this.any(e,t,n,r);return typeof i=="undefined"&&$rdf.log.error("No value found for the(){"+e+" "+t+" "+n+"}."),i},$rdf.Formula.prototype.whether=function(e,t,n,r){return this.statementsMatching(e,t,n,r,!1).length},$rdf.RDFParser=function(e){var t={};t.ns={RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#"},t.nodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},this.frameFactory=function(e,n,r){return{NODE:1,ARC:2,parent:n,parser:e,store:e.store,element:r,lastChild:0,base:null,lang:null,node:null,nodeType:null,listIndex:1,rdfid:null,datatype:null,collection:!1,terminateFrame:function(){this.collection&&this.node.close()},addSymbol:function(e,t){t=$rdf.Util.uri.join(t,this.base),this.node=this.store.sym(t),this.nodeType=e},loadTriple:function(){this.parent.parent.collection?this.parent.parent.node.append(this.node):this.store.add(this.parent.parent.node,this.parent.node,this.node,this.parser.why);if(this["parent"]["rdfid"]!=null){var e=this.store.sym($rdf.Util.uri.join("#"+this.parent.rdfid,this.base));this.store.add(e,this.store.sym(t.ns.RDF+"type"),this.store.sym(t.ns.RDF+"Statement"),this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"subject"),this.parent.parent.node,this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"predicate"),this.parent.node,this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"object"),this.node,this.parser.why)}},isTripleToLoad:function(){return this["parent"]!=null&&this["parent"]["parent"]!=null&&this["nodeType"]==this["NODE"]&&this["parent"]["nodeType"]==this["ARC"]&&this["parent"]["parent"]["nodeType"]==this["NODE"]},addNode:function(e){this.addSymbol(this.NODE,e),this.isTripleToLoad()&&this.loadTriple()},addCollection:function(){this.nodeType=this.NODE,this.node=this.store.collection(),this.collection=!0,this.isTripleToLoad()&&this.loadTriple()},addCollectionArc:function(){this.nodeType=this.ARC},addBNode:function(e){e!=null?this["parser"]["bnodes"][e]!=null?this.node=this.parser.bnodes[e]:this.node=this.parser.bnodes[e]=this.store.bnode():this.node=this.store.bnode(),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()},addArc:function(e){e==t["ns"]["RDF"]+"li"&&(e=t.ns.RDF+"_"+this.parent.listIndex++),this.addSymbol(this.ARC,e)},addLiteral:function(e){this.parent.datatype?this.node=this.store.literal(e,"",this.store.sym(this.parent.datatype)):this.node=this.store.literal(e,this.lang),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()}}},this.getAttributeNodeNS=function(e,t,n){var r=null;if(e.getAttributeNodeNS)r=e.getAttributeNodeNS(t,n);else{var i=e.attributes,s,o;for(var u=0;u<i.length;++u){s=i[u];if(s.namespaceURI==t){o=s.prefix?s.prefix+":"+n:n;if(o==s.nodeName){r=s;break}}}}return r},this.store=e,this.bnodes={},this.why=null,this.reify=!1,this.parse=function(e,n,r){var i=e.childNodes;this.cleanParser();if(e["nodeType"]==t["nodeType"]["DOCUMENT"]){for(var s=0;s<i.length;s++)if(i[s]["nodeType"]==t["nodeType"]["ELEMENT"]){var o=i[s];break}}else{if(e["nodeType"]!=t["nodeType"]["ELEMENT"])throw new Error("RDFParser: can't find root in "+n+". Halting. ");var o=e}this.why=r;var u=this.frameFactory(this);return this.base=n,u.base=n,u.lang="",this.parseDOM(this.buildFrame(u,o)),!0},this.parseDOM=function(e){var n=function(e){var t="";if(e["namespaceURI"]==null)throw new Error("RDF/XML syntax error: No namespace for "+e.localName+" in "+this.base);return e.namespaceURI&&(t+=e.namespaceURI),e.localName?t+=e.localName:e.nodeName&&(e.nodeName.indexOf(":")>=0?t+=e.nodeName.split(":")[1]:t+=e.nodeName),t},r=!0;while(e.parent){var i=e.element,s=i.attributes;if(i["nodeType"]==t["nodeType"]["TEXT"]||i["nodeType"]==t["nodeType"]["CDATA_SECTION"])e.addLiteral(i.nodeValue);else if(n(i)!=t["ns"]["RDF"]+"RDF"){e.parent&&e.parent.collection&&(e.addCollectionArc(),e=this.buildFrame(e,e.element),e.parent.element=null);if(!e.parent||!e.parent.nodeType||e["parent"]["nodeType"]==e["ARC"]){var o=this.getAttributeNodeNS(i,t.ns.RDF,"about"),u=this.getAttributeNodeNS(i,t.ns.RDF,"ID");if(o&&u)throw new Error("RDFParser: "+i.nodeName+" has both rdf:id and rdf:about."+" Halting. Only one of these"+" properties may be specified on a"+" node.");if(o==null&&u)e.addNode("#"+u.nodeValue),i.removeAttributeNode(u);else if(o==null&&u==null){var a=this.getAttributeNodeNS(i,t.ns.RDF,"nodeID");a?(e.addBNode(a.nodeValue),i.removeAttributeNode(a)):e.addBNode()}else e.addNode(o.nodeValue),i.removeAttributeNode(o);var f=this.getAttributeNodeNS(i,t.ns.RDF,"type");t["ns"]["RDF"]+"Description"!=n(i)&&(f={nodeValue:n(i)}),f!=null&&(this.store.add(e.node,this.store.sym(t.ns.RDF+"type"),this.store.sym($rdf.Util.uri.join(f.nodeValue,e.base)),this.why),f.nodeName&&i.removeAttributeNode(f));for(var l=s.length-1;l>=0;l--)this.store.add(e.node,this.store.sym(n(s[l])),this.store.literal(s[l].nodeValue,e.lang),this.why)}else{e.addArc(n(i));if(this.reify){var u=this.getAttributeNodeNS(i,t.ns.RDF,"ID");u&&(e.rdfid=u.nodeValue,i.removeAttributeNode(u))}var c=this.getAttributeNodeNS(i,t.ns.RDF,"parseType"),h=this.getAttributeNodeNS(i,t.ns.RDF,"datatype");h&&(e.datatype=h.nodeValue,i.removeAttributeNode(h));if(c){var p=c.nodeValue;p=="Literal"?(e.datatype=t.ns.RDF+"XMLLiteral",e=this.buildFrame(e),e.addLiteral(i),r=!1):p=="Resource"?(e=this.buildFrame(e,e.element),e.parent.element=null,e.addBNode()):p=="Collection"&&(e=this.buildFrame(e,e.element),e.parent.element=null,e.addCollection()),i.removeAttributeNode(c)}if(s["length"]!=0){var d=this.getAttributeNodeNS(i,t.ns.RDF,"resource"),a=this.getAttributeNodeNS(i,t.ns.RDF,"nodeID");e=this.buildFrame(e),d?(e.addNode(d.nodeValue),i.removeAttributeNode(d)):a?(e.addBNode(a.nodeValue),i.removeAttributeNode(a)):e.addBNode();for(var l=s.length-1;l>=0;l--){var v=this.buildFrame(e);v.addArc(n(s[l])),n(s[l])==t["ns"]["RDF"]+"type"?this.buildFrame(v).addNode(s[l].nodeValue):this.buildFrame(v).addLiteral(s[l].nodeValue)}}else i["childNodes"]["length"]==0&&this.buildFrame(e).addLiteral("")}}i=e.element;while(e.parent){var m=e;while(i==null)e=e.parent,i=e.element;var g=i.childNodes[e.lastChild];if(g==null||!r){e.terminateFrame();if(!(e=e.parent))break;i=e.element,r=!0}else{if((g["nodeType"]==t["nodeType"]["ELEMENT"]||g["nodeType"]==t["nodeType"]["TEXT"]||g["nodeType"]==t["nodeType"]["CDATA_SECTION"])&&(g["nodeType"]!=t["nodeType"]["TEXT"]&&g["nodeType"]!=t["nodeType"]["CDATA_SECTION"]||i["childNodes"]["length"]==1)){e.lastChild++,e=this.buildFrame(m,i.childNodes[e.lastChild-1]);break}e.lastChild++}}}},this.cleanParser=function(){this.bnodes={},this.why=null},this.buildFrame=function(e,n){var r=this.frameFactory(this,e,n);e&&(r.base=e.base,r.lang=e.lang);if(n==null||n["nodeType"]==t["nodeType"]["TEXT"]||n["nodeType"]==t["nodeType"]["CDATA_SECTION"])return r;var i=n.attributes,s=n.getAttributeNode("xml:base");s!=null&&(r.base=s.nodeValue,n.removeAttribute("xml:base"));var o=n.getAttributeNode("xml:lang");o!=null&&(r.lang=o.nodeValue,n.removeAttribute("xml:lang"));for(var u=i.length-1;u>=0;u--)if(i[u]["nodeName"]["substr"](0,3)=="xml"){if(i[u].name.slice(0,6)=="xmlns:"){var a=i[u].nodeValue;this.base&&(a=$rdf.Util.uri.join(a,this.base)),this.store.setPrefixForURI(i[u].name.slice(6),a)}n.removeAttributeNode(i[u])}return r}},Zotero.Translate=function(e){Zotero.debug("Translate: WARNING: new Zotero.Translate() is deprecated; please don't use this if you don't have to");var t=Zotero.Translate.newInstance(e);for(var n in t)this[n]=t[n];this.constructor=t.constructor,this.__proto__=t.__proto__},Zotero.Translate.newInstance=function(e){return new(Zotero.Translate[e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase()])},Zotero.Translate.Sandbox={_inheritFromBase:function(e){var t={};for(var n in Zotero.Translate.Sandbox.Base)t[n]=Zotero.Translate.Sandbox.Base[n];for(var n in e)t[n]=e[n];return t},Base:{_itemDone:function(e,t){e._complete&&Zotero.debug("Translate: WARNING: Zotero.Item#complete() called after Zotero.done(); please fix your code",2);const n=["complete","attachments","seeAlso","creators","tags","notes"];delete t.complete;for(var r in t){var i=t[r];if(!i&&i!==0){delete t[r];continue}var s=typeof i,o=s==="object"||s==="xml"||s==="function",u=n.indexOf(r)!==-1;o&&!u?(e._debug("Translate: WARNING: typeof "+r+" is "+s+"; converting to string"),t[r]=i.toString()):u&&!o?(e._debug("Translate: WARNING: typeof "+r+" is "+s+"; converting to array"),t[r]=[i]):s==="string"&&(t[r]=i.trim())}if(e._libraryID===!1||e._parentTranslator){e.newItems.push(t),e._runHandler("itemDone",t,t);return}t.id||(t.id=Zotero.Utilities.randomString());if(Zotero.isConnector){var a=t.attachments,f=a.length;for(var l=0;l<f;l++)a[l].document&&(a[l].url=a[l].document.location.href,a[l].mimeType="text/html",delete a[l].document)}e._runHandler("itemSaving",t),e instanceof Zotero.Translate.Web?e.saveQueue.push(t):e._saveItems([t])},getOption:function(e,t){if(typeof t!="string")throw new Error("getOption: option must be a string");return e._displayOptions[t]},getHiddenPref:function(e,t){if(typeof t!="string")throw new Error("getPref: preference must be a string");var n=e._translatorInfo.hiddenPrefs||{},r;try{r=Zotero.Prefs.get("translators."+t)}catch(i){}return r!==undefined?r:n[t]},loadTranslator:function(e,t){const n=function(e,n){t!=="export"&&(!n._handlers.itemDone||!n._handlers.itemDone.length)&&n.setHandler("itemDone",function(t,n){e.Sandbox._itemDone(e,n)}),(!n._handlers.selectItems||!n._handlers.selectItems.length)&&n.setHandler("selectItems",e._handlers.selectItems)};if(typeof t!="string")throw new Error("loadTranslator: type must be a string");Zotero.debug("Translate: Creating translate instance of type "+t+" in sandbox");var r=Zotero.Translate.newInstance(t);r._parentTranslator=e;if(r instanceof Zotero.Translate.Export&&!(r instanceof Zotero.Translate.Export))throw new Error("Only export translators may call other export translators");var i={};i.__exposedProps__={setSearch:"r",setDocument:"r",setHandler:"r",setString:"r",setTranslator:"r",getTranslators:"r",translate:"r",getTranslatorObject:"r"},i.setSearch=function(e){return Zotero.isBookmarklet||(e=JSON.parse(JSON.stringify(e))),r.setSearch(e)},i.setDocument=function(e){return r.setDocument(e)};var s=!1;i.setHandler=function(t,n){t==="error"&&(s=!0),r.setHandler(t,function(r,i){try{if(t=="itemDone")if(Zotero.isFx&&!Zotero.isBookmarklet&&(e instanceof Zotero.Translate.Web||e instanceof Zotero.Translate.Search)){var s=i.attachments;i.attachments=[],i=e._sandboxManager.sandbox.Zotero._transferItem(JSON.stringify(i));if(s)for(var o=0;o<s.length;o++){var u=s[o],a=u.document?u.document:undefined;delete u.document,u=e._sandboxManager.sandbox.Zotero._transferItem(JSON.stringify(u)),a&&(u.document=a),i.attachments.push(u)}}else i.complete=e._sandboxManager.sandbox.Zotero.Item.prototype.complete;n(r,i)}catch(f){e.complete(!1,f)}})},i.setString=function(e){r.setString(e)},i.setTranslator=function(t){var n=r.setTranslator(t);if(!n)throw new Error("Translator "+e.translator[0].translatorID+" attempted to call invalid translatorID "+t)};var o=!1;i.getTranslators=function(){if(!r._handlers.translators||!r._handlers.translators.length){if(Zotero.isConnector)throw new Error('Translator must register a "translators" handler to call getTranslators() in this translation environment.');e._debug('COMPAT WARNING: Translator must register a "translators" handler to call getTranslators() in connector')}return o||r.setHandler("translators",function(){e.decrementAsyncProcesses("safeTranslator#getTranslators()")}),e.incrementAsyncProcesses
("safeTranslator#getTranslators()"),r.getTranslators()};var u=!1;return i.translate=function(){return e.incrementAsyncProcesses("safeTranslator#translate()"),n(e,r),u||(u=!0,r.setHandler("done",function(){e.decrementAsyncProcesses("safeTranslator#translate()")})),s||(s=!0,r.setHandler("error",function(t,n){e.complete(!1,n)})),r.translate(!1)},i.getTranslatorObject=function(t){t?e.incrementAsyncProcesses("safeTranslator#getTranslatorObject()"):e._debug("COMPAT WARNING: Translator must pass a callback to getTranslatorObject() to operate in connector");var i,s=function(s){r.translator[0]=s,r._loadTranslator(s,function(){if(Zotero.isFx&&!Zotero.isBookmarklet){var s=Components.classes["@mozilla.org/scriptsecuritymanager;1"].getService(Components.interfaces.nsIScriptSecurityManager),o=Components.classes["@mozilla.org/network/io-service;1"].getService(Components.interfaces.nsIIOService),u=o.newURI(typeof e._sandboxLocation=="object"?e._sandboxLocation.location:e._sandboxLocation,null,null),a=o.newURI(typeof r._sandboxLocation=="object"?r._sandboxLocation.location:r._sandboxLocation,null,null);try{s.checkSameOriginURI(u,a,!1)}catch(f){throw new Error("getTranslatorObject() may not be called from web or search translators to web or search translators from different origins.")}}r._prepareTranslation(),n(e,r),i=r._sandboxManager.sandbox,Zotero.Utilities.isEmpty(i.exports)?e._debug("COMPAT WARNING: "+r.translator[0].label+" does "+"not export any properties. Only detect"+r._entryFunctionSuffix+" and do"+r._entryFunctionSuffix+" will be available in "+"connectors."):(i.exports.Zotero=i.Zotero,i=i.exports);if(t){try{t(i)}catch(f){e.complete(!1,f);return}e.decrementAsyncProcesses("safeTranslator#getTranslatorObject()")}})};if(typeof r.translator[0]=="object")return s(r.translator[0]),r._sandboxManager.sandbox;if(Zotero.isConnector&&(!Zotero.isFx||Zotero.isBookmarklet)&&!t)throw new Error("Translator must pass a callback to getTranslatorObject() to operate in this translation environment.");Zotero.Translators.get(r.translator[0],s);if(Zotero.isConnector&&Zotero.isFx&&!t)while(!i&&e._currentState)Zotero.mainThread.processNextEvent(!0);if(i)return i},i},wait:function(e){},done:function(e,t){e._currentState==="detect"&&(e._returnValue=t)},debug:function(e,t,n){e._debug(t,n)}},Web:{selectItems:function(e,t,n){function r(t){return Zotero.isFx?e._sandboxManager.sandbox.JSON.parse(JSON.stringify(t)):t}if(Zotero.Utilities.isEmpty(t))throw new Error("Translator called select items with no items");if(Object.prototype.toString.call(t)==="[object Array]"){e._debug("WARNING: Zotero.selectItems should be called with an object, not an array");var i={};for(var s in t)i[s]=t[s];t=i}if(e._selectedItems)return r(e._selectedItems);if(e._handlers.select){var o=!!n,u=!1,a=null,f=!1;if(o)var l=function(t){f=!0,n(r(t)),u&&e.decrementAsyncProcesses("Zotero.selectItems()")};else var l=function(t){f=!0,u?e.translate(e._libraryID,e._saveAttachments,t):a=r(t)};var c=e._runHandler("select",t,l);return c!==undefined?(Zotero.debug("WARNING: Returning items from a select handler is deprecated. Please pass items as to the callback provided as the third argument to the handler."),a=r(c),u=!1):u=!f,o?(u?e.incrementAsyncProcesses("Zotero.selectItems()"):f||n(a),!1):(e._debug("COMPAT WARNING: No callback was provided for Zotero.selectItems(). When executed outside of Firefox, a selectItems() call will require this translator to be called multiple times.",1),u?(e._aborted=!0,!1):a)}return n&&n(t),t},_itemDone:function(e,t){if(!e._parentTranslator){t.itemType||(t.itemType="webpage",e._debug("WARNING: No item type specified"));if(t.type=="attachment"||t.type=="note"){Zotero.debug("Translate: Discarding standalone "+t.type+" in non-import translator",2);return}t.repository!==undefined&&(Zotero.debug("Translate: 'repository' field is now 'libraryCatalog'; please fix your code",2),t.libraryCatalog=t.repository,delete t.repository),t.libraryCatalog===undefined&&(t.libraryCatalog=e.translator[0].label),t.url&&typeof t.accessDate=="undefined"&&(t.accessDate="CURRENT_TIMESTAMP");var n=Zotero.ItemFields.getName(Zotero.ItemFields.getFieldIDFromTypeAndBase(t.itemType,"title"));n&&t[n]&&(t.title=t[n]);if(!t.title){e.complete(!1,new Error("No title specified for item"));return}if(t.shortTitle===undefined&&Zotero.Utilities.fieldIsValidForType("shortTitle",t.itemType)){var r=!1,i=t.title,s=i.indexOf(":");s!==-1&&(i=i.substr(0,s),r=!0),s=i.indexOf("?"),s!==-1&&(s++,s!=i.length&&(i=i.substr(0,s),r=!0)),r&&(t.shortTitle=i)}if(t.tags)for(var o=0;o<t.tags.length;o++){var u=t.tags[o];tagString=typeof u=="string"?u:typeof u=="object"?u.tag||u.name:null,tagString&&tagString.length>255&&(e._debug("WARNING: Skipping unsynchable tag "+JSON.stringify(tagString)),t.tags.splice(o--,1))}for(var o=0;o<t.attachments.length;o++){var a=t.attachments[o];a.url&&(a.url=e.resolveURL(a.url,a.snapshot===!1))}}Zotero.Translate.Sandbox.Base._itemDone(e,t)},monitorDOMChanges:function(e,t,n){if(e._currentState!="detect"){Zotero.debug("Translate: monitorDOMChanges can only be called during the 'detect' stage");return}var r=e.document.defaultView,i=r&&(r.MutationObserver||r.WebKitMutationObserver||r.MozMutationObserver);if(!i){Zotero.debug("Translate: This browser does not support mutation observers.");return}var s=e._potentialTranslators[0];e._registeredDOMObservers[s.translatorID]||(e._registeredDOMObservers[s.translatorID]=[]);var o=e._registeredDOMObservers[s.translatorID];if(o.indexOf(t)!=-1){Zotero.debug("Translate: Already monitoring this node");return}o.push(t);var u=new i(function(n,r){o.splice(o.indexOf(t),1),r.disconnect(),Zotero.debug("Translate: Page modified.");var i=n[0].target.ownerDocument;e._runHandler("pageModified",i)});u.observe(t,n||{childList:!0,subtree:!0}),Zotero.debug("Translate: Mutation observer registered on <"+t.nodeName+"> node")}},Import:{_collectionDone:function(e,t){if(e._libraryID==0)e.newCollections.push(t),e._runHandler("collectionDone",t);else{var n=e._itemSaver.saveCollection(t);e.newCollections.push(n),e._runHandler("collectionDone",n)}},setProgress:function(e,t){typeof t!="number"?e._progress=null:e._progress=t}},Export:{nextItem:function(e){var t=e._itemGetter.nextItem();return e._displayOptions.hasOwnProperty("exportTags")&&!e._displayOptions.exportTags&&(t.tags=[]),e._runHandler("itemDone",t),t},nextCollection:function(e){if(!e._translatorInfo.configOptions||!e._translatorInfo.configOptions.getCollections)throw new Error("getCollections configure option not set; cannot retrieve collection");return e._itemGetter.nextCollection()},setProgress:function(e,t){Zotero.Translate.Sandbox.Import.setProgress(e,t)}},Search:{_itemDone:function(e,t){t.libraryCatalog===undefined&&(t.libraryCatalog=e.translator[0].label),Zotero.Translate.Sandbox.Web._itemDone(e,t)}}},Zotero.Translate.Base=function(){},Zotero.Translate.Base.prototype={init:function(){this._handlers=[],this._currentState=null,this._translatorInfo=null,this.document=null,this.location=null},setLocation:function(e){this.location=e,typeof this.location=="object"?this.path=e.path:this.path=e},setTranslator:function(e){if(!e)throw new Error("No translator specified");this.translator=null;if(typeof e=="object"){if(!e.translatorID)throw new Error("No translatorID specified");this.translator=[e]}else this.translator=[e];return!!this.translator},setHandler:function(e,t){this._handlers[e]||(this._handlers[e]=new Array),this._handlers[e].push(t)},clearHandlers:function(e){this._handlers[e]=new Array},removeHandler:function(e,t){var n=this._handlers[e].indexOf(t);n!==-1&&this._handlers[e].splice(n,1)},incrementAsyncProcesses:function(e){this._runningAsyncProcesses++,this._parentTranslator&&this._parentTranslator.incrementAsyncProcesses(e+" from child translator")},decrementAsyncProcesses:function(e,t){this._runningAsyncProcesses-=t?t:1,!!this._parentTranslator,this._runningAsyncProcesses===0&&this.complete(),this._parentTranslator&&this._parentTranslator.decrementAsyncProcesses(e+" from child translator",t)},_runHandler:function(e){var t=undefined;if(this._handlers[e]){if(this._parentTranslator)var n=[null];else var n=[this];for(var r=1;r<arguments.length;r++)n.push(arguments[r]);var i=this._handlers[e].slice();for(var r=0,s=i.length;r<s;r++){Zotero.debug("Translate: Running handler "+r+" for "+e,5);try{t=i[r].apply(null,n)}catch(o){if(this._parentTranslator)throw o;Zotero.debug("Translate: "+o+" in handler "+r+" for "+e,5),Zotero.logError(o)}}}return t},getTranslators:function(e,t){if(this._currentState==="detect")throw new Error("getTranslators: detection is already running");this._currentState="detect",this._getAllTranslators=e;if(t){if(!this.translator||!this.translator[0])throw new Error("getTranslators: translator must be set via setTranslator before calling getTranslators with the checkSetTranslator flag");var n=new Array,r;for(var i=0,s=this.translator.length;i<s;i++)typeof this.translator[i]=="string"?(r=Zotero.Translators.get(this.translator[i]),r||Zotero.debug("getTranslators: could not retrieve translator '"+this.translator[i]+"'")):r=this.translator[i],r&&n.push(r);if(!n.length)throw new Error("getTranslators: no valid translators were set.");this._getTranslatorsTranslatorsReceived(n)}else this._getTranslatorsGetPotentialTranslators();if(!this._currentState)return this._foundTranslators},_getTranslatorsGetPotentialTranslators:function(){var e=this;Zotero.Translators.getAllForType(this.type,function(t){e._getTranslatorsTranslatorsReceived(t)})},_getTranslatorsTranslatorsReceived:function(e,t){this._potentialTranslators=[],this._foundTranslators=[],this._properToProxyFunctions=t?t:null,this._waitingForRPC=!1;for(var n=0,r=e.length;n<r;n++){var i=e[n];i.runMode===Zotero.Translator.RUN_MODE_IN_BROWSER?this._potentialTranslators.push(i):this instanceof Zotero.Translate.Web&&Zotero.Connector&&(this._waitingForRPC=!0)}if(this._waitingForRPC){var s=this;Zotero.Connector.callMethod("detect",{uri:this.location.toString(),cookie:this.document.cookie,html:this.document.documentElement.innerHTML},function(e){s._getTranslatorsRPCComplete(e)})}this._detect()},_getTranslatorsRPCComplete:function(e){this._waitingForRPC=!1;if(e){for(var t=0,n=e.length;t<n;t++)e[t].runMode=Zotero.Translator.RUN_MODE_ZOTERO_STANDALONE;this._foundTranslators=this._foundTranslators.concat(e)}this._currentState===null&&this._detectTranslatorsCollected()},translate:function(e,t){this._currentState="translate";if(!this.translator||!this.translator.length){this.complete(!1,new Error("No translator specified"));return}this._libraryID=e,this._saveAttachments=t===undefined||t,this._savingAttachments=[],this._savingItems=0;var n=this;typeof this.translator[0]=="object"?this._loadTranslator(this.translator[0],function(){n._translateTranslatorLoaded()}):Zotero.Translators.get(this.translator[0],function(e){n.translator[0]=e,n._loadTranslator(e,function(){n._translateTranslatorLoaded()})})},_translateTranslatorLoaded:function(){if(!this.translator[0].code){this.complete(!1,new Error("Translator "+this.translator[0].label+" is unsupported within this environment"));return}this._displayOptions||(this._displayOptions=this._translatorInfo.displayOptions||{}),this._prepareTranslation(),Zotero.debug("Translate: Beginning translation with "+this.translator[0].label),this.incrementAsyncProcesses("Zotero.Translate#translate()");try{this._sandboxManager.sandbox["do"+this._entryFunctionSuffix].apply(null,this._getParameters())}catch(e){return this.complete(!1,e),!1}this.decrementAsyncProcesses("Zotero.Translate#translate()")},getProgress:function(){return null},resolveURL:function(e,t){const n=/^((?:http|https|ftp):)\/\/([^\/]+)/i;var r="";if(n.test(e))this.translator&&this.translator[0]&&this.translator[0].properToProxy&&!t?r=this.translator[0].properToProxy(e):r=e;else if(Zotero.isFx)r=Components.classes["@mozilla.org/network/io-service;1"].getService(Components.interfaces.nsIIOService).newURI(this.location,"",null).resolve(e);else if(Zotero.isNode)r=require("url").resolve(this.location,e);else{var i=document.createElement("a");i.href=e,r=i.href}return r},complete:function(e,t){if(this._aborted)return;if(this._currentState===null){if(!e)Zotero.debug("Translate: WARNING: Zotero.done() called after translator completion with error"),Zotero.debug(t);else{var n=new Error;Zotero.debug("Translate: WARNING: Zotero.done() called after translation completion. This should never happen. Please examine the stack below."),Zotero.debug(n.stack)}return}var r=this._currentState;this._parentTranslator&&this._runningAsyncProcesses&&this._parentTranslator.decrementAsyncProcesses("Zotero.Translate#complete",this._runningAsyncProcesses),this._runningAsyncProcesses=0,!e&&this._returnValue&&(e=this._returnValue);var i=null;!e&&t&&(i=this._generateErrorString(t));if(r==="detect"){if(this._potentialTranslators.length){var s=this._potentialTranslators.shift(),o=this._properToProxyFunctions?this._properToProxyFunctions.shift():null;if(e){var u={properToProxy:o};for(var a in s)u[a]=s[a];Zotero.isBookmarklet&&e==="server"?u.runMode=Zotero.Translator.RUN_MODE_ZOTERO_SERVER:u.itemType=e,this._foundTranslators.push(u)}else t&&this._debug("Detect using "+s.label+" failed: \n"+i,2)}this._potentialTranslators.length&&(this._getAllTranslators||!e)?this._detect():(this._currentState=null,this._waitingForRPC||this._detectTranslatorsCollected())}else{this._currentState=null,e===undefined&&(e=!0);if(e){if(this.saveQueue.length){this._saveItems(this.saveQueue),this.saveQueue=[];return}this._debug("Translation successful")}else t&&(Zotero.logError(t),this._debug("Translation using "+(this.translator&&this.translator[0]&&this.translator[0].label?this.translator[0].label:"no translator")+" failed: \n"+i,2)),this._runHandler("error",t);this._runHandler("itemsDone",e),e?this._checkIfDone():this._runHandler("done",e)}return i},_saveItems:function(e){var t=this,n=!1,r=[],i=[];this._savingItems++,this._itemSaver.saveItems(e.slice(),function(s,o){if(s){for(var u=0;u<e.length;u++){var a=e[u];for(var f=0;f<a.attachments.length;f++)i.indexOf(a.attachments[f])===-1&&a.attachments.splice(f--,1)}for(var u=0,l=e.length;u<l;u++)t._runHandler("itemDone",o[u],e[u]);n=!0;for(var u=0;u<r.length;u++)t._runHandler("attachmentProgress",r[u][0],r[u][1],r[u][2]);t.newItems=t.newItems.concat(o),t._savingItems--,t._checkIfDone()}else Zotero.logError(o),t.complete(s,o)},function(e,s,o){var u=t._savingAttachments.indexOf(e);s===!1||s===100?u!==-1&&t._savingAttachments.splice(u,1):u===-1&&t._savingAttachments.push(e),n?(t._runHandler("attachmentProgress",e,s,o),t._checkIfDone()):(r.push([e,s,o]),i.push(e))})},_checkIfDone:function(){!this._savingItems&&!this._savingAttachments.length&&!this._currentState&&this._runHandler("done",!0)},_detect:function(){if(!this._potentialTranslators.length){this.complete(!0);return}var e=this;this._loadTranslator(this._potentialTranslators[0],function(){e._detectTranslatorLoaded()})},_detectTranslatorLoaded:function(){this._prepareDetection(),this.incrementAsyncProcesses("Zotero.Translate#getTranslators");try{var e=this._sandboxManager.sandbox["detect"+this._entryFunctionSuffix].apply(null,this._getParameters())}catch(t){this.complete(!1,t);return}e!==undefined&&(this._returnValue=e),this.decrementAsyncProcesses("Zotero.Translate#getTranslators")},_detectTranslatorsCollected:function(){Zotero.debug("Translate: All translator detect calls and RPC calls complete"),this._foundTranslators.sort(function(e,t){return e.priority-t.priority}),this._runHandler("translators",this._foundTranslators)},_loadTranslator:function(e,t){var n=this._getSandboxLocation();if(!this._sandboxLocation||n!==this._sandboxLocation)this._sandboxLocation=n,this._generateSandbox();this._currentTranslator=e,this._runningAsyncProcesses=0,this._returnValue=undefined,this._aborted=!1,this.saveQueue=[],Zotero.debug("Translate: Parsing code for "+e.label,4);try{this._sandboxManager.eval("var exports = {}, ZOTERO_TRANSLATOR_INFO = "+e.code,["detect"+this._entryFunctionSuffix,"do"+this._entryFunctionSuffix,"exports","ZOTERO_TRANSLATOR_INFO"],e.file?e.file.path:e.label)}catch(r){this.complete(!1,r);return}this._translatorInfo=this._sandboxManager.sandbox.ZOTERO_TRANSLATOR_INFO,t&&t()},_generateSandbox:function(){Zotero.debug("Translate: Binding sandbox to "+(typeof this._sandboxLocation=="object"?this._sandboxLocation.document.location:this._sandboxLocation),4),this._sandboxManager=new Zotero.Translate.SandboxManager(this._sandboxLocation);const e="['creators', 'notes', 'tags', 'seeAlso', 'attachments']";var t="var Zotero = {};Zotero.Item = function (itemType) {const createArrays = "+e+";"+"this.itemType = itemType;"+"for(var i=0, n=createArrays.length; i<n; i++) {"+"this[createArrays[i]] = [];"+"}"+"};";if(this instanceof Zotero.Translate.Export||this instanceof Zotero.Translate.Import)t+="Zotero.Collection = function () {};Zotero.Collection.prototype.complete = function() { Zotero._collectionDone(this); };";Zotero.isFx&&!Zotero.isBookmarklet?t+="Zotero._transferItem = function(itemString) {var item = JSON.parse(itemString);item.complete = Zotero.Item.prototype.complete;return item;};Zotero.Item.prototype.complete = function() { for(var key in this) {if("+e+".indexOf(key) !== -1) {"+"for each(var item in this[key]) {"+"for(var key2 in item) {"+"if(typeof item[key2] === 'xml') {"+"item[key2] = item[key2].toString();"+"}"+"}"+"}"+"} else if(typeof this[key] === 'xml') {"+"this[key] = this[key].toString();"+"}"+"}":t+="Zotero.Item.prototype.complete = function() { ",t+="Zotero._itemDone(this);}",this._sandboxManager.eval(t),this._sandboxManager.importObject(this.Sandbox,this),this._sandboxManager.importObject({Utilities:new Zotero.Utilities.Translate(this)}),this._sandboxManager.sandbox.Zotero.Utilities.HTTP=this._sandboxManager.sandbox.Zotero.Utilities,this._sandboxManager.sandbox.Zotero.isBookmarklet=Zotero.isBookmarklet||!1,this._sandboxManager.sandbox.Zotero.isConnector=Zotero.isConnector||!1,this._sandboxManager.sandbox.Zotero.isServer=Zotero.isServer||!1,this._sandboxManager.sandbox.Zotero.parentTranslator=this._parentTranslator&&this._parentTranslator._currentTranslator?this._parentTranslator._currentTranslator.translatorID:null,this._sandboxManager.sandbox.Z=this._sandboxManager.sandbox.Zotero,this._sandboxManager.sandbox.ZU=this._sandboxManager.sandbox.Zotero.Utilities},_debug:function(e,t){if(t!==undefined&&typeof t!="number"){Zotero.debug("debug: level must be an integer");return}this._runHandler("debug",e)!==!1&&(typeof e=="string"&&(e="Translate: "+e),Zotero.debug(e,t))},_generateErrorString:function(e){var t="";if(typeof e=="string")t="\nthrown exception => "+e;else{var n=!1;for(var r in e)typeof e[r]!="object"&&(r==="stack"&&(n=!0),t+="\n"+r+" => "+e[r]);t+="\nstring => "+e.toString(),!n&&e.stack&&(t+="\nstack => "+e.stack.toString())}return t+="\nurl => "+this.path+"\ndownloadAssociatedFiles => "+Zotero.Prefs.get("downloadAssociatedFiles")+"\nautomaticSnapshots => "+Zotero.Prefs.get("automaticSnapshots"),t.substr(1)},_getSandboxLocation:function(){return this._parentTranslator?this._parentTranslator._sandboxLocation:"http://www.example.com/"},_getParameters:function(){return[]},_prepareDetection:function(){},_prepareTranslation:function(){}},Zotero.Translate.Web=function(){this._registeredDOMObservers={},this.init()},Zotero.Translate.Web.prototype=new Zotero.Translate.Base,Zotero.Translate.Web.prototype.type="web",Zotero.Translate.Web.prototype._entryFunctionSuffix="Web",Zotero.Translate.Web.prototype.Sandbox=Zotero.Translate.Sandbox._inheritFromBase(Zotero.Translate.Sandbox.Web),Zotero.Translate.Web.prototype.setDocument=function(e){this.document=e,this.setLocation(e.location.href)},Zotero.Translate.Web.prototype.setCookieSandbox=function(e){this.cookieSandbox=e},Zotero.Translate.Web.prototype.setLocation=function(e){this.location=e,this.path=this.location},Zotero.Translate.Web.prototype._getTranslatorsGetPotentialTranslators=function(){var e=this;Zotero.Translators.getWebTranslatorsForLocation(this.location,function(t){e._getTranslatorsTranslatorsReceived(t[0],t[1])})},Zotero.Translate.Web.prototype._getSandboxLocation=function(){return this._parentTranslator?this._parentTranslator._sandboxLocation:!this.document.defaultView||this.document.defaultView.toString().indexOf("Window")===-1&&this.document.defaultView.toString().indexOf("XrayWrapper")===-1?this.document.location.toString():this.document.defaultView},Zotero.Translate.Web.prototype._getParameters=function(){return[this.document,this.location]},Zotero.Translate.Web.prototype._prepareTranslation=function(){this._itemSaver=new Zotero.Translate.ItemSaver(this._libraryID,Zotero.Translate.ItemSaver[this._saveAttachments?"ATTACHMENT_MODE_DOWNLOAD":"ATTACHMENT_MODE_IGNORE"],1,this.document,this._cookieSandbox,this.location),this.newItems=[]},Zotero.Translate.Web.prototype.translate=function(e,t,n){this._selectedItems=n,Zotero.Translate.Base.prototype.translate.apply(this,[e,t])},Zotero.Translate.Web.prototype._translateTranslatorLoaded=function(){var e=this.translator[0].runMode;if(e===Zotero.Translator.RUN_MODE_IN_BROWSER||this._parentTranslator)Zotero.Translate.Base.prototype._translateTranslatorLoaded.apply(this);else if(e===Zotero.Translator.RUN_MODE_ZOTERO_STANDALONE||e===Zotero.Translator.RUN_MODE_ZOTERO_SERVER&&Zotero.Connector.isOnline){var t=this;Zotero.Connector.callMethod("savePage",{uri:this.location.toString(),translatorID:typeof this.translator[0]=="object"?this.translator[0].translatorID:this.translator[0],cookie:this.document.cookie,html:this.document.documentElement.innerHTML},function(e){t._translateRPCComplete(e)})}else if(e===Zotero.Translator.RUN_MODE_ZOTERO_SERVER){var t=this;Zotero.API.createItem({url:this.document.location.href.toString()},null,function(e,n){t._translateServerComplete(e,n)})}},Zotero.Translate.Web.prototype._translateRPCComplete=function(e,t){e||this.complete(!1,t);if(e.selectItems){var n=this;this._runHandler("select",e.selectItems,function(t){Zotero.Connector.callMethod("selectItems",{instanceID:e.instanceID,selectedItems:t},function(e){n._translateRPCComplete(e)})})}else{for(var r=0,i=e.items.length;r<i;r++)this._runHandler("itemDone",null,e.items[r]);this.newItems=e.items,this.complete(!0)}},Zotero.Translate.Web.prototype._translateServerComplete=function(e,t){if(e===300){try{t=JSON.parse(t)}catch(n){Zotero.logError(n),this.complete(!1,"Invalid JSON response received from server");return}var r=this;this._runHandler("select",t,function(e){Zotero.API.createItem({url:r.document.location.href.toString(),items:e},null,function(e,t){r._translateServerComplete(e,t)})})}else if(e===201){try{t=(new DOMParser).parseFromString(t,"application/xml")}catch(n){Zotero.logError(n),this.complete(!1,"Invalid XML response received from server");return}var i=[],s;"getElementsByTagNameNS"in t?s=t.getElementsByTagNameNS("http://www.w3.org/2005/Atom","content"):s=t.getElementsByTagName("content");for(var o=0,u=s.length;o<u;o++){var a=s[o];if("getAttributeNS"in a){if(a.getAttributeNS("http://zotero.org/ns/api","type")!="json")continue}else if(a.getAttribute("zapi:type")!="json")continue;try{var f=JSON.parse("textContent"in a?a.textContent:a.text)}catch(n){Zotero.logError(n),this.complete(!1,"Invalid JSON response received from server");return}"attachments"in f||(f.attachments=[]),this._runHandler("itemDone",null,f),i.push(f)}this.newItems=i,this.complete(!0)}else this.complete(!1,t)},Zotero.Translate.Web.prototype.complete=function(e,t){var n=this._currentState,r=Zotero.Translate.Base.prototype.complete.apply(this,[e,t]);if(n=="translate"&&r&&!this._parentTranslator&&this.translator.length&&this.translator[0].inRepository&&Zotero.Prefs.get("reportTranslationFailure")){if(Zotero.isFx&&!Zotero.isBookmarklet&&!Zotero.isStandalone&&Components.classes["@mozilla.org/privatebrowsing;1"]){var i=Components.classes["@mozilla.org/privatebrowsing;1"].getService(Components.interfaces.nsIPrivateBrowsingService);if(i.privateBrowsingEnabled)return}var s=this.translator[0];Zotero.getSystemInfo(function(e){var t="id="+encodeURIComponent(s.translatorID)+"&lastUpdated="+encodeURIComponent(s.lastUpdated)+"&diagnostic="+encodeURIComponent(e)+"&errorData="+encodeURIComponent(r);Zotero.HTTP.doPost("http://www.zotero.org/repo/report",t)})}},Zotero.Translate.Import=function(){this.init()},Zotero.Translate.Import.prototype=new Zotero.Translate.Base,Zotero.Translate.Import.prototype.type="import",Zotero.Translate.Import.prototype._entryFunctionSuffix="Import",Zotero.Translate.Import.prototype._io=!1,Zotero.Translate.Import.prototype.Sandbox=Zotero.Translate.Sandbox._inheritFromBase(Zotero.Translate.Sandbox.Import),Zotero.Translate.Import.prototype.setString=function(e){this._string=e,this._io=!1},Zotero.Translate.Import.prototype.complete=function(e,t){this._io&&(this._progress=null,this._io.close(!1)),Zotero.Translate.Base.prototype.complete.apply(this,[e,t])},Zotero.Translate.Import.prototype._getTranslatorsGetPotentialTranslators=function(){if(this.location){var e=this;Zotero.Translators.getImportTranslatorsForLocation(this.location,function(t){e._getTranslatorsTranslatorsReceived(t)})}else Zotero.Translate.Base.prototype._getTranslatorsGetPotentialTranslators.call(this)},Zotero.Translate.Import.prototype.getTranslators=function(){if(!!this._string||!!this.location)return Zotero.Translate.Base.prototype.getTranslators.call(this);if(this._currentState==="detect")throw new Error("getTranslators: detection is already running");this._currentState="detect";var e=this;Zotero.Translators.getAllForType(this.type,function(t){e._potentialTranslators=[],e._foundTranslators=t,e.complete(!0)});if(this._currentState===null)return this._foundTranslators},Zotero.Translate.Import.prototype._loadTranslator=function(e,t){var n=this;Zotero.Translate.Base.prototype._loadTranslator.call(this,e,function(){n._loadTranslatorPrepareIO(e,t)})},Zotero.Translate.Import.prototype._loadTranslatorPrepareIO=function(e,t){var n=this._translatorInfo.configOptions,r=n?n.dataMode:"",i=this,s=function(e,n){e?(i._sandboxManager.importObject(i._io),t&&t()):i.complete(!1,n)},o=!1;if(!this._io){if(Zotero.Translate.IO.Read&&this.location&&this.location instanceof Components.interfaces.nsIFile)try{this._io=new Zotero.Translate.IO.Read(this.location)}catch(u){o=u}else try{this._io=new Zotero.Translate.IO.String(this._string,this.path?this.path:"")}catch(u){o=u}if(o){this.complete(!1,o);return}}try{this._io.init(r,s)}catch(u){o=u}if(o){this.complete(!1,o);return}},Zotero.Translate.Import.prototype._prepareTranslation=function(){this._progress=undefined;var e=null;if(this.location)try{e=Components.classes["@mozilla.org/network/io-service;1"].getService(Components.interfaces.nsIIOService).newFileURI(this.location)}catch(t){}this._itemSaver=new Zotero.Translate.ItemSaver(this._libraryID,Zotero.Translate.ItemSaver[this._saveAttachments?"ATTACHMENT_MODE_FILE":"ATTACHMENT_MODE_IGNORE"],undefined,undefined,undefined,e),this.newItems=[],this.newCollections=[]},Zotero.Translate.Import.prototype.getProgress=function(){return this._progress!==undefined?this._progress:Zotero.Translate.IO.rdfDataModes.indexOf(this._mode)!==-1||this._mode==="xml/e4x"||this._mode=="xml/dom"||!this._io?null:this._io.bytesRead/this._io.contentLength*100},Zotero.Translate.Export=function(){this.init()},Zotero.Translate.Export.prototype=new Zotero.Translate.Base,Zotero.Translate.Export.prototype.type="export",Zotero.Translate.Export.prototype._entryFunctionSuffix="Export",Zotero.Translate.Export.prototype.Sandbox=Zotero.Translate.Sandbox._inheritFromBase(Zotero.Translate.Sandbox.Export),Zotero.Translate.Export.prototype.setItems=function(e){this._items=e,delete this._collection},Zotero.Translate.Export.prototype.setCollection=function(e){this._collection=e,delete this._items},Zotero.Translate.Export.prototype.setTranslator=function(e){return typeof e=="object"&&e.displayOptions&&(this._displayOptions=e.displayOptions),Zotero.Translate.Base.prototype.setTranslator.apply(this,[e])},Zotero.Translate.Export.prototype.setDisplayOptions=function(e){this._displayOptions=e},Zotero.Translate.Export.prototype.complete=function(e,t){this._io&&(this._progress=null,this._io.close(!0),this._io instanceof Zotero.Translate.IO.String&&(this.string=this._io.string)),Zotero.Translate.Base.prototype.complete.apply(this,[e,t])},Zotero.Translate.Export.prototype.getTranslators=function(){if(this._currentState==="detect")throw new Error("getTranslators: detection is already running");return this._currentState="detect",this._foundTranslators=Zotero.Translators.getAllForType(this.type),this._potentialTranslators=[],this.complete(!0),this._foundTranslators},Zotero.Translate.Export.prototype._prepareTranslation=function(){this._progress=undefined,this._itemGetter=new Zotero.Translate.ItemGetter;var e=this._translatorInfo.configOptions||{},t=e.getCollections||!1;this._collection?(this._itemGetter.setCollection(this._collection,t),delete this._collection):this._items?(this._itemGetter.setItems(this._items),delete this._items):this._itemGetter.setAll(t),this._displayOptions.exportFileData&&(this.location=this._itemGetter.exportFiles(this.location,this.translator[0].target));if(!this.location)this._io=new Zotero.Translate.IO.String(null,this.path?this.path:""),this._io.init(e.dataMode,function(){});else{if(!Zotero.Translate.IO.Write)throw new Error("Writing to files is not supported in this build of Zotero.");this._io=new Zotero.Translate.IO.Write(this.location),this._io.init(e.dataMode,this._displayOptions.exportCharset?this._displayOptions.exportCharset:null,function(){})}this._sandboxManager.importObject(this._io)},Zotero.Translate.Export.prototype.getProgress=function(){return this._progress!==undefined?this._progress:this._itemGetter?(1-this._itemGetter.numItemsRemaining/this._itemGetter.numItems)*100:null},Zotero.Translate.Search=function(){this.init()},Zotero.Translate.Search.prototype=new Zotero.Translate.Base,Zotero.Translate.Search.prototype.type="search",Zotero.Translate.Search.prototype._entryFunctionSuffix="Search",Zotero.Translate.Search.prototype.Sandbox=Zotero.Translate.Sandbox._inheritFromBase(Zotero.Translate.Sandbox.Search),Zotero.Translate.Search.prototype.setCookieSandbox=Zotero.Translate.Web.prototype.setCookieSandbox,Zotero.Translate.Search.prototype.setSearch=function(e){this.search=e},Zotero.Translate.Search.prototype.getTranslators=function(){return Zotero.Translate.Base.prototype.getTranslators.call(this,!0)},Zotero.Translate.Search.prototype.setTranslator=function(e){if(typeof e=="object"&&!e.translatorID){this.translator=[];for(var t=0,n=e.length;t<n;t++)this.translator.push(e[t]);return!0}return Zotero.Translate.Base.prototype.setTranslator.apply(this,[e])},Zotero.Translate.Search.prototype.complete=function(e,t){if(this._currentState=="translate"&&(!this.newItems||!this.newItems.length)&&this.translator.length){Zotero.debug("Translate: Could not find a result using "+this.translator[0].label,3),t&&Zotero.debug(this._generateErrorString(t),3);if(this.translator.length>1){this.translator.shift(),this.translate(this._libraryID,this._saveAttachments);return}t="No items returned from any translator",e=!1}Zotero.Translate.Base.prototype.complete.apply(this,[e,t])},Zotero.Translate.Search.prototype._getParameters=function(){return Zotero.isFx?[this._sandboxManager.sandbox.Zotero._transferItem(JSON.stringify(this.search))]:[this.search]},Zotero.Translate.Search.prototype._getSandboxLocation=function(){if(this.translator&&this.translator[0]&&this.translator[0].target){const e=/^http:\/\/[\w.]+\//;var t=this.translator[0].target.replace(/\\/g,"").replace(/\^/g,""),n=e.exec(t);if(n)return n[0]}return Zotero.Translate.Base.prototype._getSandboxLocation.call(this)},Zotero.Translate.Search.prototype._prepareTranslation=Zotero.Translate.Web.prototype._prepareTranslation,Zotero.Translate.IO={parseDOMXML:function(e,t,n){try{var r=new DOMParser}catch(i){try{var r=Components.classes["@mozilla.org/xmlextras/domparser;1"].createInstance(Components.interfaces.nsIDOMParser)}catch(i){throw new Error("DOMParser not supported")}}if(typeof e=="string")var s=r.parseFromString(e,"text/xml");else var s=r.parseFromStream(e,t,n,"text/xml");if(s.getElementsByTagName("parsererror").length)throw"DOMParser error: loading data into data store failed";return"normalize"in s&&s.normalize(),s},rdfDataModes:["rdf","rdf/xml","rdf/n3"]},Zotero.Translate.IO.String=function(e,t){e&&typeof e=="string"?this.string=e:this.string="",this.contentLength=this.string.length,this.bytesRead=0,this._uri=t},Zotero.Translate.IO.String.prototype={__exposedProps__:{RDF:"r",read:"r",write:"r",setCharacterSet:"r",getXML:"r"},_initRDF:function(e){Zotero.debug
("Translate: Initializing RDF data store"),this._dataStore=new Zotero.RDF.AJAW.IndexedFormula,this.RDF=new Zotero.Translate.IO._RDFSandbox(this._dataStore);if(this.contentLength){try{var t=Zotero.Translate.IO.parseDOMXML(this.string)}catch(n){throw this._xmlInvalid=!0,n}var r=new Zotero.RDF.AJAW.RDFParser(this._dataStore);r.parse(t,this._uri)}e(!0)},setCharacterSet:function(e){},read:function(e){Zotero.Translate.IO.rdfDataModes.indexOf(this._mode)!==-1&&this.string===""&&(this.string=this.RDF.serialize());if(this.bytesRead>=this.contentLength)return!1;if(e!==undefined){if(this.bytesRead>=this.contentLength)return!1;var t=this.bytesRead;return this.bytesRead+=e,this.string.substr(t,e)}var t=this.bytesRead,n=this.string.indexOf("\n",this.bytesRead);if(n!==-1)return this.bytesRead=n+1,this.contentLength>n&&this.string.substr(n-1,1)==="\r"&&n--,this.string.substr(t,n-t);if(!this._noCR){var r=this.string.indexOf("\r",this.bytesRead);if(r!==-1)return this.bytesRead=r+1,this.string.substr(t,r-t-1);this._noCR=!0}return this.bytesRead=this.contentLength,this.string.substr(t)},write:function(e){this.string+=e,this.contentLength=this.string.length},getXML:function(){try{var e=Zotero.Translate.IO.parseDOMXML(this.string)}catch(t){throw this._xmlInvalid=!0,t}return Zotero.isFx?Zotero.Translate.DOMWrapper.wrap(e):e},init:function(e,t){this.bytesRead=0,this._noCR=undefined,this._mode=e;if(e==="xml/e4x")throw"E4X is not supported";if(e&&(Zotero.Translate.IO.rdfDataModes.indexOf(e)!==-1||e.substr(0,3)==="xml/dom")&&this._xmlInvalid)throw"XML known invalid";Zotero.Translate.IO.rdfDataModes.indexOf(this._mode)!==-1?this._initRDF(t):t(!0)},close:function(e){e&&Zotero.Translate.IO.rdfDataModes.indexOf(this._mode)!==-1&&this.string===""&&(this.string=this.RDF.serialize())}},Zotero.Translate.IO._RDFSandbox=function(e){this._dataStore=e},Zotero.Translate.IO._RDFSandbox.prototype={_containerCounts:[],__exposedProps__:{addStatement:"r",newResource:"r",newContainer:"r",addContainerElement:"r",getContainerElements:"r",addNamespace:"r",getAllResources:"r",getResourceURI:"r",getArcsIn:"r",getArcsOut:"r",getSources:"r",getTargets:"r",getStatementsMatching:"r",serialize:"r"},_getResource:function(e){return typeof e=="object"?e:new Zotero.RDF.AJAW.Symbol(e)},_init:function(){this._prepFunction&&(this._dataStore=this._prepFunction(),delete this._prepFunction)},serialize:function(e){var t=Zotero.RDF.AJAW.Serializer(this._dataStore);for(var n in this._dataStore.namespaces)t.suggestPrefix(n,this._dataStore.namespaces[n]);return e=="rdf/n3"?t.statementsToN3(this._dataStore.statements):t.statementsToXML(this._dataStore.statements)},addStatement:function(e,t,n,r){if(e===null||e===undefined)throw new Error("about must be defined in Zotero.RDF.addStatement");if(t===null||t===undefined)throw new Error("relation must be defined in Zotero.RDF.addStatement");if(n===null||n===undefined)throw new Error("value must be defined in Zotero.RDF.addStatement");r?n=n.toString().replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g,""):n=this._getResource(n),this._dataStore.add(this._getResource(e),this._getResource(t),n)},newResource:function(){return new Zotero.RDF.AJAW.BlankNode},newContainer:function(e,t){const n="http://www.w3.org/1999/02/22-rdf-syntax-ns#",r={bag:"Bag",seq:"Seq",alt:"Alt"};e=e.toLowerCase();if(!r[e])throw new Error("Invalid container type in Zotero.RDF.newContainer");var t=this._getResource(t);return this.addStatement(t,n+"type",n+r[e],!1),this._containerCounts[t.toNT()]=1,t},addContainerElement:function(e,t,n){const r="http://www.w3.org/1999/02/22-rdf-syntax-ns#";var e=this._getResource(e);this._dataStore.add(e,new Zotero.RDF.AJAW.Symbol(r+"_"+this._containerCounts[e.toNT()]++),t,n)},getContainerElements:function(e){const t="http://www.w3.org/1999/02/22-rdf-syntax-ns#_";var e=this._getResource(e),n=this._dataStore.statementsMatching(e),r=[];for(var i=0;i<n.length;i++){var s=n[i];if(s.predicate.uri.substr(0,t.length)==t){var o=s.predicate.uri.substr(t.length),u=parseInt(o);o==u.toString()&&(r[u-1]=s.object.termType=="literal"?s.object.toString():s.object)}}return r},addNamespace:function(e,t){this._dataStore.setPrefixForURI(e,t)},getResourceURI:function(e){if(typeof e=="string")return e;if(e.uri)return e.uri;if(e.toNT==undefined)throw new Error("Zotero.RDF: getResourceURI called on invalid resource");return e.toNT()},getAllResources:function(){var e=[];for(var t in this._dataStore.subjectIndex)e.push(this._dataStore.subjectIndex[t][0].subject);return e},getArcsIn:function(e){var t=this._dataStore.objectIndex[this._dataStore.canon(this._getResource(e))];if(!t)return!1;var n=[];for(var r=0;r<t.length;r++)n.push(t[r].predicate.uri);return n},getArcsOut:function(e){var t=this._dataStore.subjectIndex[this._dataStore.canon(this._getResource(e))];if(!t)return!1;var n=[];for(var r=0;r<t.length;r++)n.push(t[r].predicate.uri);return n},getSources:function(e,t){var n=this._dataStore.statementsMatching(undefined,this._getResource(t),this._getResource(e));if(!n.length)return!1;var r=[];for(var i=0;i<n.length;i++)r.push(n[i].subject);return r},getTargets:function(e,t){var n=this._dataStore.statementsMatching(this._getResource(e),this._getResource(t));if(!n.length)return!1;var r=[];for(var i=0;i<n.length;i++)r.push(n[i].object.termType=="literal"?n[i].object.toString():n[i].object);return r},getStatementsMatching:function(e,t,n,r,i){var s=this._dataStore.statementsMatching(e?this._getResource(e):undefined,t?this._getResource(t):undefined,n?r?r:this._getResource(n):undefined,undefined,i);if(!s.length)return!1;var o=[];for(var u=0;u<s.length;u++)o.push([s[u].subject,s[u].predicate,s[u].object.termType=="literal"?s[u].object.toString():s[u].object]);return o}},Zotero.Translate.ItemSaver=function(e,t,n,r,i){this.newItems=[],this._timeoutID=null,r&&(this._uri=r.location.toString(),this._cookie=r.cookie),Zotero.Messaging&&!Zotero.Translate.ItemSaver._attachmentCallbackListenerAdded&&(Zotero.isBookmarklet||Zotero.isSafari)&&(Zotero.Messaging.addMessageListener("attachmentCallback",function(e){var t=e[0],n=e[1],r=Zotero.Translate.ItemSaver._attachmentCallbacks[t];r&&(n===!1||n===100?delete Zotero.Translate.ItemSaver._attachmentCallbacks[t]:e[1]=50+e[1]/2,r(e[1],e[2]))}),Zotero.Translate.ItemSaver._attachmentCallbackListenerAdded=!0)},Zotero.Translate.ItemSaver._attachmentCallbackListenerAdded=!1,Zotero.Translate.ItemSaver._attachmentCallbacks={},Zotero.Translate.ItemSaver.ATTACHMENT_MODE_IGNORE=0,Zotero.Translate.ItemSaver.ATTACHMENT_MODE_DOWNLOAD=1,Zotero.Translate.ItemSaver.ATTACHMENT_MODE_FILE=2,Zotero.Translate.ItemSaver.prototype={saveItems:function(e,t,n){var r=this,i={items:e};this._uri&&this._cookie&&(i.uri=this._uri,i.cookie=this._cookie),Zotero.Connector.callMethod("saveItems",i,function(i,s){if(i!==!1){Zotero.debug("Translate: Save via Standalone succeeded");var o=!1;if(i&&i.items)for(var u=0;u<i.items.length;u++){var a=e[u].attachments=i.items[u].attachments;for(var f=0;f<a.length;f++)a[f].id&&(n(a[f],0),o=!0)}t(!0,e),o&&r._pollForProgress(e,n)}else Zotero.isFx?t(!1,new Error("Save via Standalone failed with "+s)):r._saveToServer(e,t,n)})},_pollForProgress:function(e,t){var n=[],r=[],i=[];for(var s=0;s<e.length;s++){var o=e[s].attachments;for(var u=0;u<o.length;u++)o[u].id&&(n.push(o[u]),r.push(o[u].id),i.push(0))}var a=0,f=function(){Zotero.Connector.callMethod("attachmentProgress",r,function(e,s){if(e){for(var o=0;o<n.length;o++)e[o]===100||e[o]===!1?(t(n[o],e[o]),n.splice(o,1),r.splice(o,1),i.splice(o,1),e.splice(o,1),o--):e[o]!==i[o]&&(t(n[o],e[o]),i[o]=e[o]);a++<60&&n.length&&setTimeout(f,1e3)}else for(var o=0;o<n.length;o++)t(n[o],!1,"Lost connection to Zotero Standalone")})};f()},_saveToServer:function(e,t,n){var r=[],i=!1;try{i=!!(new Uint8Array(1)&&new Blob)}catch(s){}for(var o=0,u=e.length;o<u;o++){var a=e[o];r.push(Zotero.Utilities.itemToServerJSON(a));if(i)for(var f=0;f<a.attachments.length;f++)a.attachments[f].id=Zotero.Utilities.randomString();else a.attachments=[]}var l=this;Zotero.API.createItem({items:r},null,function(r,s){r!==201?t(!1,new Error("Save to server failed")):(Zotero.debug("Translate: Save to server complete"),Zotero.Prefs.getCallback(["downloadAssociatedFiles","automaticSnapshots"],function(r){if(i){try{var o=l._getItemKeysFromServerResponse(s)}catch(u){t(!1,u);return}for(var a=0;a<e.length;a++){var f=e[a],c=o[a];f.attachments&&f.attachments.length&&l._saveAttachmentsToServer(c,l._getFileBaseNameFromItem(f),f.attachments,r,n)}}t(!0,e)}))})},_saveAttachmentsToServer:function(e,t,n,r,i){var s=this,o=[],u=n.length,a=function(){if(o.length===0)return;var t=[];for(var n=0;n<o.length;n++){var r=o[n];t.push({itemType:"attachment",linkMode:r.linkMode,title:r.title?r.title.toString():"Untitled Attachment",accessDate:"CURRENT_TIMESTAMP",url:r.url,note:r.note?r.note.toString():"",tags:r.tags&&r.tags instanceof Array?r.tags:[]})}Zotero.API.createItem({items:t},e,function(e,t){var n;if(e===201)try{var r=s._getItemKeysFromServerResponse(t)}catch(u){n=new Error("Unexpected response received from server")}else n=new Error("Unexpected status "+e+" received from server");Zotero.debug("Finished creating items");for(var a=0;a<o.length;a++){var f=o[a];n?attachmentProgress(f,!1,n):(f.key=r[a],f.linkMode==="linked_url"?i(f,100):"data"in f&&s._uploadAttachmentToServer(f,i))}n&&Zotero.logError(n)})};for(var f=0;f<n.length;f++)(function(e){var n=null;delete e.key,delete e.data;var f=!1;if(e.mimeType)switch(e.mimeType.toLowerCase()){case"text/html":case"application/xhtml+xml":f=!0}if(f&&!r.automaticSnapshots||!f&&!r.downloadAssociatedFiles){--u===0&&a();return}if(e.snapshot===!1&&e.mimeType){e.linkMode="linked_url",o.push(e),i&&i(e,0),--u===0&&a();return}var l=function(){if(n!==null)return n;u--,n=!1;var r=null,s=c.status;if(s===0||e.snapshot===!1)e.linkMode="linked_url";else if(s!==200)r=new Error("Server returned unexpected status code "+s);else{var f="application/octet-stream",l=null,h=c.getResponseHeader("Content-Type");if(h){var p=/^[^\x00-\x1F\x7F()<>@,;:\\"\/\[\]?={} ]+\/[^\x00-\x1F\x7F()<>@,;:\\"\/\[\]?={} ]+/.exec(h);p&&(f=p[0].toLowerCase()),p=/;\s*charset\s*=\s*("[^"]+"|[^\x00-\x1F\x7F()<>@,;:\\"\/\[\]?={} ]+)/.exec(h),p&&(l=p[1],l[0]==='"'&&(l=l.substring(1,l.length-1))),e.mimeType&&e.mimeType.toLowerCase()!==f.toLowerCase()&&(r=new Error("Attachment MIME type "+f+" does not match specified type "+e.mimeType))}if(!r){e.mimeType=f,e.linkMode="imported_url";switch(f.toLowerCase()){case"application/pdf":e.filename=t+".pdf";break;case"text/html":case"application/xhtml+xml":e.filename=t+".html";break;default:e.filename=t}l&&(e.charset=l),n=!0}}return n===!1&&"abort"in c&&c.abort(),r||o.push(e),u===0&&a(),r&&(i(e,!1,r),Zotero.logError(r)),n},c=new XMLHttpRequest;c.open(e.snapshot===!1?"HEAD":"GET",e.url,!0),c.responseType=f?"document":"arraybuffer",c.onreadystatechange=function(){if(c.readyState!==4||!l())return;i(e,50),e.data=c.response,"key"in e&&s._uploadAttachmentToServer(e,i)},c.onprogress=function(t){if(c.readyState<2||!l())return;t.total&&i&&i(e,t.loaded/t.total*50)},c.send(),i&&i(e,0)})(n[f])},_uploadAttachmentToServer:function(e,t){Zotero.debug("Uploading attachment to server");switch(e.mimeType.toLowerCase()){case"text/html":case"application/xhtml+xml":if(e.data instanceof ArrayBuffer){var n=this,r=new Blob([e.data],{type:e.mimeType}),i=new FileReader;i.onloadend=function(){if(i.error)t(e,!1,i.error);else{var r=i.result,s;try{s=(new DOMParser).parseFromString(r,"text/html")}catch(o){}if(!s){s=document.implementation.createHTMLDocument("");var u=s.documentElement;u.innerHTML=r,u.children.length===1&&u.firstElementChild==="html"&&s.replaceChild(u.firstElementChild,u)}e.data=s,n._uploadAttachmentToServer(e,t)}},i.readAsText(r,e.charset||"iso-8859-1");return}var s=e.data,o=s.getElementsByTagName("head");if(!o.length){o=s.createElement("head");var u=e.data.documentElement;u.insertBefore(o,u.firstChildElement)}else o=o[0];var a=s.createElement("base");a.href=e.url,o.appendChild(a);var f=s.getElementsByTagName("meta"),l;for(var c=0;c<f.length;c++){l=f[c];var h=l.getAttribute("http-equiv");h&&h.toLowerCase()==="content-type"&&l.parentNode.removeChild(l)}l=s.createElement("meta"),l.setAttribute("http-equiv","Content-Type"),l.setAttribute("content",e.mimeType+"; charset=UTF-8"),o.insertBefore(l,o.firstChild);var p=(new XMLSerializer).serializeToString(s),d=Zotero.Utilities.getStringByteLength(p),v=new Uint8Array(d);Zotero.Utilities.stringToUTF8Array(p,v),e.data=v.buffer,e.charset="UTF-8"}var m=this._md5(new Uint8Array(e.data),0,e.data.byteLength),g="";for(var c=0;c<m.length;c++)m[c]<16&&(g+="0"),g+=m[c].toString(16);e.md5=g,Zotero.isChrome&&!Zotero.isBookmarklet?Zotero.API.uploadAttachment(e,t.bind(this,e)):(Zotero.Translate.ItemSaver._attachmentCallbacks[e.id]=function(n,r){t(e,n,r)},Zotero.API.uploadAttachment(e))},_getItemKeysFromServerResponse:function(e){try{e=(new DOMParser).parseFromString(e,"text/xml")}catch(t){throw new Error("Save to server returned invalid output")}var n=e.getElementsByTagNameNS("http://zotero.org/ns/api","key"),r=[];for(var i=0,s=n.length;i<s;i++)r.push("textContent"in n[i]?n[i].textContent:n[i].innerText);return r},_getFileBaseNameFromItem:function(e){var t=[];e.creators&&e.creators.length&&(e.creators.length===1?t.push(e.creators[0].lastName):e.creators.length===2?t.push(e.creators[0].lastName+" and "+e.creators[1].lastName):t.push(e.creators[0].lastName+" et al."));if(e.date){var n=Zotero.Date.strToDate(e.date);n.year&&t.push(n.year)}return e.title&&t.push(e.title.substr(0,50)),t.length?t.join(" - "):"Attachment"},_md5:function(){function i(e,r,i){var s=1732584193,o=-271733879,u=-1732584194,a=271733878,f=i+72&-64,l=new Uint8Array(f),c,h,p;r||i!=e.byteLength?l.set(new Uint8Array(e.buffer,r,i)):l.set(e),c=i,l[c++]=128,p=f-8;while(c<p)l[c++]=0;l[c++]=i<<3&255,l[c++]=i>>5&255,l[c++]=i>>13&255,l[c++]=i>>21&255,l[c++]=i>>>29&255,l[c++]=0,l[c++]=0,l[c++]=0;var d=new Int32Array(16);for(c=0;c<f;){for(h=0;h<16;++h,c+=4)d[h]=l[c]|l[c+1]<<8|l[c+2]<<16|l[c+3]<<24;var v=s,m=o,g=u,y=a,b,w;for(h=0;h<64;++h){h<16?(b=m&g|~m&y,w=h):h<32?(b=y&m|~y&g,w=5*h+1&15):h<48?(b=m^g^y,w=3*h+5&15):(b=g^(m|~y),w=7*h&15);var E=y,S=v+b+n[h]+d[w]|0,x=t[h];y=g,g=m,m=m+(S<<x|S>>>32-x)|0,v=E}s=s+v|0,o=o+m|0,u=u+g|0,a=a+y|0}return new Uint8Array([s&255,s>>8&255,s>>16&255,s>>>24&255,o&255,o>>8&255,o>>16&255,o>>>24&255,u&255,u>>8&255,u>>16&255,u>>>24&255,a&255,a>>8&255,a>>16&255,a>>>24&255])}try{var t=new Uint8Array([7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21]),n=new Int32Array([-680876936,-389564586,606105819,-1044525330,-176418897,1200080426,-1473231341,-45705983,1770035416,-1958414417,-42063,-1990404162,1804603682,-40341101,-1502002290,1236535329,-165796510,-1069501632,643717713,-373897302,-701558691,38016083,-660478335,-405537848,568446438,-1019803690,-187363961,1163531501,-1444681467,-51403784,1735328473,-1926607734,-378558,-2022574463,1839030562,-35309556,-1530992060,1272893353,-155497632,-1094730640,681279174,-358537222,-722521979,76029189,-640364487,-421815835,530742520,-995338651,-198630844,1126891415,-1416354905,-57434055,1700485571,-1894986606,-1051523,-2054922799,1873313359,-30611744,-1560198380,1309151649,-145523070,-1120210379,718787259,-343485551])}catch(r){}return i}()},Zotero.Translate.SandboxManager=function(e){this.sandbox={Zotero:{}}},Zotero.Translate.SandboxManager.prototype={eval:function(code,functions){for(var i in functions)delete this.sandbox[functions[i]];with(this.sandbox)eval(code);for(var i in functions)try{this.sandbox[functions[i]]=eval(functions[i])}catch(e){}},importObject:function(e,t,n){n||(n=this.sandbox.Zotero);for(var r in e.__exposedProps__?e.__exposedProps__:e){if(Function.prototype[r])continue;typeof e[r]=="function"||typeof e[r]=="object"?(n[r]=new function(){var n=e[r];return function(){var r=t?[t]:[];for(var i=0;i<arguments.length;i++)r.push(arguments[i]);return n.apply(e,r)}},this.importObject(e[r],t?t:null,n[r])):n[r]=e[r]}}},Zotero.Translators={getConverterFunctions:function(e){var t=new Array(e.length);for(var n=0;n<e.length;n++)e[n]===null?t[n]=null:t[n]=new function(){var t=new RegExp("^https?://(?:[^/]\\.)?"+Zotero.Utilities.quotemeta(e[n][0]),"gi"),r=e[n][1].replace(/\$/g,"$$$$");return function(e){return e.replace(t,"$&."+r)}};return t}},Zotero.Translator=function(){},Zotero.Translator.RUN_MODE_IN_BROWSER=1,Zotero.Translator.RUN_MODE_ZOTERO_STANDALONE=2,Zotero.Translator.RUN_MODE_ZOTERO_SERVER=4,Zotero.Connector_Types.schema={itemTypes:{1:["note","Note",[!1],[],{},"treeitem-note.png"],2:["book","Book",[1,2,3,5,4],[110,90,3,30,4,45,6,7,8,14,118,87,11,116,1,27,123,19,62,18,2,22],{},"treeitem-book.png"],3:["bookSection","Book Section",[1,29,2,3,5,4],[110,90,115,3,30,4,45,6,7,8,14,10,87,11,116,1,27,123,19,62,18,2,22],{115:12},"treeitem-bookSection.png"],4:["journalArticle","Journal Article",[1,2,3,27,4],[110,90,12,4,5,10,14,3,28,29,25,87,26,13,116,1,27,123,19,62,18,2,22],{},"treeitem-journalArticle.png"],5:["magazineArticle","Magazine Article",[1,2,27,4],[110,90,12,4,5,14,10,87,13,116,1,27,123,19,62,18,2,22],{},"treeitem-magazineArticle.png"],6:["newspaperArticle","Newspaper Article",[1,2,27,4],[110,90,12,7,6,14,15,10,87,116,13,1,27,123,19,62,18,2,22],{},"treeitem-newspaperArticle.png"],7:["thesis","Thesis",[1,2],[110,90,69,89,7,14,118,87,116,1,27,123,19,62,18,2,22],{69:108,89:8},"treeitem-thesis.png"],8:["letter","Letter",[1,2,16],[110,90,65,14,87,116,1,27,123,19,62,18,2,22],{65:108},"treeitem-letter.png"],9:["manuscript","Manuscript",[1,2,4],[110,90,66,7,14,118,87,116,1,27,123,19,62,18,2,22],{66:108},"treeitem-manuscript.png"],10:["interview","Interview",[6,2,7,4],[110,90,14,64,87,116,1,27,123,19,62,18,2,22],{64:109},"treeitem-interview.png"],11:["film","Film",[8,2,10,9],[110,90,21,14,122,63,77,87,116,1,27,123,19,62,18,2,22],{21:8,122:108,63:109},"treeitem-film.png"],12:["artwork","Artwork",[22,2],[110,90,59,61,14,87,116,123,19,62,18,1,27,2,22],{59:109},"treeitem-artwork.png"],13:["webpage","Web Page",[1,2,4],[110,90,91,70,14,116,1,27,87,2,22],{91:12,70:108},"treeitem-webpage.png"],14:["attachment","Attachment",[!1],[110,27,1],{},"treeitem.png"],15:["report","Report",[1,2,5,4],[110,90,92,32,28,7,31,14,10,87,116,1,27,123,19,62,18,2,22],{92:60,32:108,31:8},"treeitem-report.png"],16:["bill","Bill",[12,2,28],[110,90,93,36,94,15,95,41,40,42,14,87,1,27,116,2,22],{93:60,94:4,95:10},"treeitem-bill.png"],17:["case","Case",[1,2,13],[111,90,43,97,44,117,98,42,96,87,116,1,27,2,22],{111:110,97:4,117:60,98:10,96:14},"treeitem-case.png"],18:["hearing","Hearing",[2],[110,90,46,7,8,45,99,10,41,40,42,14,87,116,1,27,2,22],{99:60},"treeitem-hearing.png"],19:["patent","Patent",[14,15,2],[110,90,7,102,48,120,50,121,10,103,51,52,53,54,87,116,1,27,2,22],{50:60,52:14},"treeitem-patent.png"],20:["statute","Statute",[1,2],[112,90,36,55,101,100,10,15,40,42,87,116,1,27,2,22],{112:110,101:60,100:14},"treeitem-statute.png"],21:["email","E-mail",[1,2,16],[113,90,14,116,1,27,87,2,22],{113:110},"treeitem-email.png"],22:["map","Map",[20,2,5],[110,90,67,68,28,6,7,8,14,87,11,116,1,27,123,19,62,18,2,22],{67:108},"treeitem-map.png"],23:["blogPost","Blog Post",[1,23,2],[110,90,107,70,14,1,27,87,116,2,22],{107:12,70:108},"treeitem-blogPost.png"],24:["instantMessage","Instant Message",[1,2,16],[110,90,14,87,116,1,27,2,22],{},"treeitem-instantMessage.png"],25:["forumPost","Forum Post",[1,2],[110,90,104,79,14,87,116,1,27,2,22],{104:12,79:108},"treeitem-forumPost.png"],26:["audioRecording","Audio Recording",[17,18,2,19],[110,90,71,28,4,45,7,72,14,77,87,11,116,123,19,62,18,1,27,2,22],{71:109,72:8},"treeitem-audioRecording.png"],27:["presentation","Presentation",[24,2],[110,90,74,14,7,75,1,27,87,116,2,22],{74:108},"treeitem-presentation.png"],28:["videoRecording","Video Recording",[8,11,2,10,9],[110,90,63,28,4,45,7,76,14,77,87,11,116,1,27,123,19,62,18,2,22],{63:109,76:8},"treeitem-videoRecording.png"],29:["tvBroadcast","TV Broadcast",[8,11,2,25,10,9],[110,90,119,105,63,7,78,14,77,87,116,1,27,123,19,62,18,2,22],{119:12,105:60,63:109,78:8},"treeitem-tvBroadcast.png"],30:["radioBroadcast","Radio Broadcast",[8,11,2,25,10,9],[110,90,119,105,71,7,78,14,77,87,116,1,27,123,19,62,18,2,22],{119:12,105:60,71:109,78:8},"treeitem-radioBroadcast.png"],31:["podcast","Podcast",[26,2,25],[110,90,28,105,80,77,1,27,87,116,2,22],{105:60,80:109},"treeitem-podcast.png"],32:["computerProgram","Computer Program",[21,2],[110,90,28,81,14,82,7,83,88,11,116,1,2,123,19,62,18,27,22],{83:8},"treeitem-computerProgram.png"],33:["conferencePaper","Conference Paper",[1,2,3,5,4],[110,90,14,114,84,7,8,4,10,3,87,26,11,116,1,27,123,19,62,18,2,22],{114:12},"treeitem-conferencePaper.png"],34:["document","Document",[1,2,3,27,4],[110,90,8,14,87,116,1,27,123,19,62,18,2,22],{},"treeitem-document.png"],35:["encyclopediaArticle","Encyclopedia Article",[1,2,3,5,4],[110,90,85,3,30,4,45,6,7,8,14,10,11,116,1,27,87,123,19,62,18,2,22],{85:12},"treeitem-encyclopediaArticle.png"],36:["dictionaryEntry","Dictionary Entry",[1,2,3,5,4],[110,90,86,3,30,4,45,6,7,8,14,10,87,11,116,1,27,123,19,62,18,2,22],{86:12},"treeitem-dictionaryEntry.png"]},creatorTypes:{1:["author","Author"],2:["contributor","Contributor"],3:["editor","Editor"],4:["translator","Translator"],5:["seriesEditor","Series Editor"],6:["interviewee","Interview With"],7:["interviewer","Interviewer"],8:["director","Director"],9:["scriptwriter","Scriptwriter"],10:["producer","Producer"],11:["castMember","Cast Member"],12:["sponsor","Sponsor"],13:["counsel","Counsel"],14:["inventor","Inventor"],15:["attorneyAgent","Attorney/Agent"],16:["recipient","Recipient"],17:["performer","Performer"],18:["composer","Composer"],19:["wordsBy","Words By"],20:["cartographer","Cartographer"],21:["programmer","Programmer"],22:["artist","Artist"],23:["commenter","Commenter"],24:["presenter","Presenter"],25:["guest","Guest"],26:["podcaster","Podcaster"],27:["reviewedAuthor","Reviewed Author"],28:["cosponsor","Cosponsor"],29:["bookAuthor","Book Author"]},fields:{1:["url"],2:["rights"],3:["series"],4:["volume"],5:["issue"],6:["edition"],7:["place"],8:["publisher"],10:["pages"],11:["ISBN"],12:["publicationTitle"],13:["ISSN"],14:["date"],15:["section"],18:["callNumber"],19:["archiveLocation"],21:["distributor"],22:["extra"],25:["journalAbbreviation"],26:["DOI"],27:["accessDate"],28:["seriesTitle"],29:["seriesText"],30:["seriesNumber"],31:["institution"],32:["reportType"],36:["code"],40:["session"],41:["legislativeBody"],42:["history"],43:["reporter"],44:["court"],45:["numberOfVolumes"],46:["committee"],48:["assignee"],50:["patentNumber"],51:["priorityNumbers"],52:["issueDate"],53:["references"],54:["legalStatus"],55:["codeNumber"],59:["artworkMedium"],60:["number"],61:["artworkSize"],62:["libraryCatalog"],63:["videoRecordingFormat"],64:["interviewMedium"],65:["letterType"],66:["manuscriptType"],67:["mapType"],68:["scale"],69:["thesisType"],70:["websiteType"],71:["audioRecordingFormat"],72:["label"],74:["presentationType"],75:["meetingName"],76:["studio"],77:["runningTime"],78:["network"],79:["postType"],80:["audioFileType"],81:["version"],82:["system"],83:["company"],84:["conferenceName"],85:["encyclopediaTitle"],86:["dictionaryTitle"],87:["language"],88:["programmingLanguage"],89:["university"],90:["abstractNote"],91:["websiteTitle"],92:["reportNumber"],93:["billNumber"],94:["codeVolume"],95:["codePages"],96:["dateDecided"],97:["reporterVolume"],98:["firstPage"],99:["documentNumber"],100:["dateEnacted"],101:["publicLawNumber"],102:["country"],103:["applicationNumber"],104:["forumTitle"],105:["episodeNumber"],107:["blogTitle"],108:["type"],109:["medium"],110:["title"],111:["caseName"],112:["nameOfAct"],113:["subject"],114:["proceedingsTitle"],115:["bookTitle"],116:["shortTitle"],117:["docketNumber"],118:["numPages"],119:["programTitle"],120:["issuingAuthority"],121:["filingDate"],122:["genre"],123:["archive"]}},Zotero.Utilities.Translate=function(e){this._translate=e};var tmp=function(){};tmp.prototype=Zotero.Utilities,Zotero.Utilities.Translate.prototype=new tmp,Zotero.Utilities.Translate.prototype.formatDate=Zotero.Date.formatDate,Zotero.Utilities.Translate.prototype.strToDate=Zotero.Date.strToDate,Zotero.Utilities.Translate.prototype.strToISO=Zotero.Date.strToISO,Zotero.Utilities.Translate.prototype.createContextObject=Zotero.OpenURL.createContextObject,Zotero.Utilities.Translate.prototype.parseContextObject=Zotero.OpenURL.parseContextObject,Zotero.Utilities.Translate.prototype.capitalizeTitle=function(e,t){if(t===undefined){var n=this._translate;do if(n.capitalizeTitles!==undefined){t=n.capitalizeTitles;break}while(n=n._parentTranslator)}return Zotero.Utilities.capitalizeTitle(e,t)},Zotero.Utilities.Translate.prototype.getVersion=function(){return Zotero.version},Zotero.Utilities.Translate.prototype.gatherElementsOnXPath=function(e,t,n,r){var i=[],s=e.evaluate(n,t,r,Zotero.isFx?Components.interfaces.nsIDOMXPathResult.ANY_TYPE:XPathResult.ANY_TYPE,null),o=s.iterateNext(),u=0;while(o)i[u++]=o,o=s.iterateNext();return i},Zotero.Utilities.Translate.prototype.getNodeString=function(e,t,n,r){var i=this.gatherElementsOnXPath(e,t,n,r),s="";for(var o=0;o<i.length;o++)s+=i[o].nodeValue;return s},Zotero.Utilities.Translate.prototype.getItemArray=function(e,t,n,r){var i=new Object;if(n)if(n.exec)var s=n;else{var s=new RegExp;s.compile(n,"i")}if(r)if(r.exec)var o=r;else{var o=new RegExp;o.compile(r,"i")}t.length||(t=new Array(t));for(var u=0;u<t.length;u++){var a=t[u].getElementsByTagName("a");for(var f=0;f<a.length;f++)if(!n||s.test(a[f].href)){var l="textContent"in a[f]?a[f].textContent:a[f].innerText;if(l){l=this.trimInternal(l);if(!r||!o.test(l))i[a[f].href]?l!=i[a[f].href]&&(i[a[f].href]+=" "+l):i[a[f].href]=l}}}return i},Zotero.Utilities.Translate.prototype.loadDocument=function(e,t,n){Zotero.debug("Zotero.Utilities.loadDocument is deprecated; please use processDocuments in new code"),this.processDocuments([e],t,null,n)},Zotero.Utilities.Translate.prototype.processDocuments=function(e,t,n,r){var i=this._translate;if(typeof e=="string")e=[i.resolveURL(e)];else for(var s in e)e[s]=i.resolveURL(e[s]);if(r)var o=function(e){var t;try{r(e)}catch(e){if(l)try{Zotero.Browser.deleteHiddenBrowser(l)}catch(e){}t=!0,i.complete(!1,e)}if(!t)try{Zotero.Browser.deleteHiddenBrowser(l)}catch(e){}};else var o=function(e){if(l)try{Zotero.Browser.deleteHiddenBrowser(l)}catch(e){}i.complete(!1,e)};if(Zotero.isFx)if(typeof i._sandboxLocation=="object")var u=i._sandboxLocation.location.protocol,a=i._sandboxLocation.location.host;else var f=Components.classes["@mozilla.org/network/io-service;1"].getService(Components.interfaces.nsIIOService).newURI(i._sandboxLocation,null,null),u=f.scheme+":",a=f.host;for(var s=0;s<e.length;s++)this._translate.document&&this._translate.document.location&&this._translate.document.location.toString()===e[s]&&(Zotero.debug("Translate: Attempted to load the current document using processDocuments; using loaded document instead"),t(this._translate.document,e[s]),e.splice(s,1),s--);i.incrementAsyncProcesses("Zotero.Utilities.Translate#processDocuments");var l=Zotero.HTTP.processDocuments(e,function(e){if(!t)return;var n=e.location;!Zotero.isFx||u==n.protocol&&a==n.host?t(e,n.toString()):t(Zotero.Translate.DOMWrapper.wrap(e),n.toString())},function(){n&&n();var e=function(){if(l)try{Zotero.Browser.deleteHiddenBrowser(l)}catch(t){}i.removeHandler("done",e)};i.setHandler("done",e),i.decrementAsyncProcesses("Zotero.Utilities.Translate#processDocuments")},o,!0,i.cookieSandbox)},Zotero.Utilities.Translate.prototype.doGet=function(e,t,n,r){var i=!1,s=this,o=this._translate;if(typeof e=="string")var u=e;else{e.length>1&&(i=!0);var u=e.shift()}u=o.resolveURL(u),o.incrementAsyncProcesses("Zotero.Utilities.Translate#doGet");var a=Zotero.HTTP.doGet(u,function(a){try{t&&t(a.responseText,a,u),i?s.doGet(e,t,n,r):n&&n(),o.decrementAsyncProcesses("Zotero.Utilities.Translate#doGet")}catch(f){o.complete(!1,f)}},r,this._translate.cookieSandbox)},Zotero.Utilities.Translate.prototype.doPost=function(e,t,n,r,i){var s=this._translate;e=s.resolveURL(e),s.incrementAsyncProcesses("Zotero.Utilities.Translate#doPost");var o=Zotero.HTTP.doPost(e,t,function(e){try{n(e.responseText,e),s.decrementAsyncProcesses("Zotero.Utilities.Translate#doPost")}catch(t){s.complete(!1,t)}},r,i,s.cookieSandbox?s.cookieSandbox:undefined)},Zotero.Utilities.Translate.prototype.__exposedProps__={HTTP:"r"};for(var j in Zotero.Utilities.Translate.prototype)typeof Zotero.Utilities.Translate.prototype[j]=="function"&&j[0]!=="_"&&j!="Translate"&&(Zotero.Utilities.Translate.prototype.__exposedProps__[j]="r");Zotero.Messaging=new function(){var e={},t={},n=!1,r=!1;this.addMessageListener=function(e,n){t[e]=n},this.init=function(){for(var i in MESSAGES){Zotero[i]||(Zotero[i]={});for(var s in MESSAGES[i])Zotero[i][s]=new function(){var t=i+MESSAGE_SEPARATOR+s,n=MESSAGES[i][s];return function(){var i,s;if(n){s=n.callbackArg?n.callbackArg:arguments.length-1,i=arguments[s];if(typeof i!="function"){Zotero.logError(new Error("Zotero: "+t+" must be called with a callback"));return}}var o=new Array(arguments.length);for(var u=0;u<arguments.length;u++)o[u]=u===s?null:arguments[u];if(i){var a=Math.floor(Math.random()*1e12);e[a]=i}var f=[a,t,o];zoteroIFrame.contentWindow.postMessage(r?f:JSON.stringify(f),ZOTERO_CONFIG.BOOKMARKLET_URL+(Zotero.isIE?"iframe_ie.html":"iframe.html"))}}}if(n)return;var o=function(n){try{var i=n.data,s=n.origin;if(n.origin!==ZOTERO_CONFIG.BOOKMARKLET_ORIGIN&&(!Zotero.isIE||n.origin!==ZOTERO_CONFIG.HTTP_BOOKMARKLET_ORIGIN))throw"Received message from invalid origin";if(typeof i=="string")try{i=JSON.parse(i)}catch(o){return}else r||(r=!0,Zotero.debug("Structured clone algorithm is supported"));if(t[i[0]]){t[i[0]](i[1],n);return}var u=i[1].split(MESSAGE_SEPARATOR),a=u[0],f=u[1],l=e[i[0]];if(!l)return;delete e[i[0]];var c=i[2],h=MESSAGES[a][f];h.postReceive&&(c=h.postReceive.apply(null,c)),l.apply(null,c)}catch(o){Zotero.logError(o)}};window.addEventListener?window.addEventListener("message",o,!1):window.attachEvent("onmessage",function(){o(event)}),n=!0}};var pos=Zotero.isIE&&document.compatMode==="BackCompat"?"absolute":"fixed",cssBookmarkletFrameDimmer={background:"black",opacity:"0.5",position:pos,top:"0px",bottom:"0px",left:"0px",right:"0px",zIndex:"16777270",height:"100%",width:"100%",filter:"alpha(opacity = 50);"},cssBookmarkletFrame={position:pos,zIndex:"16777271",top:"50%",left:"50%",background:"white"};Zotero.initInject(),Zotero.Connector_Types.init();var BookmarkletFrame=function(e,t,n){var r=window.parent,i=r.document;this._appendFrameTo=document.body?document.body:document.documentElement,this._appendDimmerTo=i.body?i.body:i.documentElement;var s,o;r.innerWidth?(s=r.innerWidth,o=r.innerHeight):i.documentElement.offsetWidth?(s=i.documentElement.offsetWidth,o=i.documentElement.offsetHeight):i.body&&i.body.offsetWidth?(s=i.body.offsetWidth,o=i.body.offsetHeight):s=o=Infinity,n=Math.min(o-10,n),t=Math.min(s-10,t),this._dimmer=i.createElement("div"),this._dimmer.style.cssText=cssDivClearString;for(var u in cssBookmarkletFrameDimmer)this._dimmer.style[u]=cssBookmarkletFrameDimmer[u];this._appendDimmerTo.appendChild(this._dimmer),e?(this._frame=document.createElement("iframe"),this._frame.src=e):(this._frame=zoteroIFrame,zoteroIFrame.style.display="block"),this._frame.style.position="absolute",this._frame.style.top="0px",this._frame.style.left="0px",this._frame.style.width="100%",this._frame.style.height="100%",this._frame.style.borderStyle="none",this._frame.setAttribute("frameborder","0");var a=window.frameElement.style;for(var u in cssBookmarkletFrame)a[u]=cssBookmarkletFrame[u];a.display="block",a.margin="-"+n/2+"px 0 0 -"+t/2+"px",a.width=t+"px",a.height=n+"px",e&&this._appendFrameTo.appendChild(this._frame)};BookmarkletFrame.prototype.remove=function(){this._appendDimmerTo.removeChild(this._dimmer),this._frame==zoteroIFrame?zoteroIFrame.style.display="none":this._appendFrameTo.removeChild(this._frame),window.frameElement.style.display="none"};var translate=new Zotero.Translate.Web,selectCallback,cancelled,haveItem,attachmentsSaving;translate.setDocument(window.parent.document),translate.setHandler("translators",function(e,t){selectCallback=cancelled=haveItem=null,t&&t.length?(t[0].runMode===Zotero.Translator.RUN_MODE_IN_BROWSER?Zotero.ProgressWindow.changeHeadline("Saving Item..."):t[0].runMode===Zotero.Translator.RUN_MODE_ZOTERO_SERVER?Zotero.ProgressWindow.changeHeadline("Saving via Server..."):Zotero.ProgressWindow.changeHeadline("Saving via Zotero Standalone..."),translate.setTranslator(t[0]),translate.translate()):(Zotero.ProgressWindow.changeHeadline("Saving Failed"),new Zotero.ProgressWindow.ErrorMessage("noTranslator"
),Zotero.ProgressWindow.startCloseTimer(8e3),cleanup())}),translate.setHandler("select",function(e,t,n){var r=new BookmarkletFrame(ZOTERO_CONFIG.BOOKMARKLET_URL+"itemSelector.html#"+encodeURIComponent(JSON.stringify([null,t])),600,350);selectCallback=function(e){r.remove(),n(e)}});var _itemProgress={};translate.setHandler("itemSaving",function(e,t){_itemProgress[t.id]||(_itemProgress[t.id]=new Zotero.ProgressWindow.ItemProgress(Zotero.ItemTypes.getImageSrc(t.itemType),t.title))}),translate.setHandler("itemDone",function(e,t,n){var r=_itemProgress[n.id];r||(r=_itemProgress[n.id]=new Zotero.ProgressWindow.ItemProgress(Zotero.ItemTypes.getImageSrc(n.itemType),n.title)),r.setProgress(100),haveItem=!0;for(var i=0;i<n.attachments.length;i++){var s=n.attachments[i];_itemProgress[s.id]=new Zotero.ProgressWindow.ItemProgress(Zotero.ItemTypes.getImageSrc(s.mimeType==="application/pdf"?"attachment-pdf":"attachment-snapshot"),s.title,r)}}),translate.setHandler("attachmentProgress",function(e,t,n){var r=_itemProgress[t.id];if(!r)return;n===!1?r.setError():(t.linkMode==="linked_url"&&r.setIcon(Zotero.ItemTypes.getImageSrc("attachment-web-link")),r.setProgress(n))}),translate.setHandler("done",function(e,t){t&&haveItem?Zotero.ProgressWindow.startCloseTimer(2500):cancelled||(new Zotero.ProgressWindow.ErrorMessage("translationError"),Zotero.ProgressWindow.startCloseTimer(8e3)),cleanup()}),Zotero.Messaging.addMessageListener("translate",function(e,t){Zotero.ProgressWindow.changeHeadline("Looking for Translators..."),Zotero.isIE&&installXPathIfNecessary(window.parent),t.origin.substr(0,6)==="https:"&&ZOTERO_CONFIG.BOOKMARKLET_URL.substr(0,5)==="http:"&&(ZOTERO_CONFIG.BOOKMARKLET_URL="https:"+ZOTERO_CONFIG.BOOKMARKLET_URL.substr(5)),translate.getTranslators()}),Zotero.Messaging.addMessageListener("selectDone",function(e){if(!e||Zotero.Utilities.isEmpty(e))cancelled=!0,Zotero.ProgressWindow.close();selectCallback(e)});var revealedFrame;Zotero.Messaging.addMessageListener("revealZoteroIFrame",function(){if(revealedFrame)return;revealedFrame=new BookmarkletFrame(null,800,400)}),Zotero.Messaging.addMessageListener("hideZoteroIFrame",function(){revealedFrame.remove()}),Zotero.isIE&&window.parent.location.protocol==="http:"&&(ZOTERO_CONFIG.BOOKMARKLET_URL=ZOTERO_CONFIG.BOOKMARKLET_URL.replace("https","http"));var zoteroIFrame;document.readyState&&document.readyState!=="interactive"&&document.readyState!=="complete"?window.onload=startTranslation:startTranslation();